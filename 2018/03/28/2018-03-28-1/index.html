<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/favicon.ico?v=5.1.4" color="#222">





  <meta name="keywords" content="servlet," />





  <link rel="alternate" href="/atom.xml" title="CloudPai" type="application/atom+xml" />






<meta name="description" content="Servlet第一篇【介绍Servlet、HTTP协议、WEB目录结构、编写入门Servlet程序、Servlet生命周期】什么是 Serlvet？Servlet 其实就是一个遵循 Servlet 开发的 java 类。Serlvet 是由服务器调用的，运行在服务器端。 为什么要用到 Serlvet？我们编写 java 程序想要在网上实现 聊天、发帖、这样一些的交互功能，普通的 java 技术是">
<meta name="keywords" content="servlet">
<meta property="og:type" content="article">
<meta property="og:title" content="Servlet学习">
<meta property="og:url" content="http://cloudpai.site/2018/03/28/2018-03-28-1/index.html">
<meta property="og:site_name" content="CloudPai">
<meta property="og:description" content="Servlet第一篇【介绍Servlet、HTTP协议、WEB目录结构、编写入门Servlet程序、Servlet生命周期】什么是 Serlvet？Servlet 其实就是一个遵循 Servlet 开发的 java 类。Serlvet 是由服务器调用的，运行在服务器端。 为什么要用到 Serlvet？我们编写 java 程序想要在网上实现 聊天、发帖、这样一些的交互功能，普通的 java 技术是">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-896f978f9f50d802.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-01ac23b210d5e6df.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-c713202668573a02.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-3f38e89de2a7b0fe.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-9cd4572e42d820a6.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-35d0b4e2530d4d3e.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-653ff9242cc376b4.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-576b4a66265b68ab.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-fe444b9c5d8b08fb.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-bcd04668df9d854c.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-e7bf088691383d6d.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-36a4a7fdcf24f063.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-cc91a5503313c836.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-aa81351d3dfaaefe.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-63e1e34d6641dcdb.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-70040f402774ed58.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-f898ba1886636fe3.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-24abd7253fa2664a.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-8e9fc5359c25b4d0.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-d500528ce9cbb3de.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-2ec566b5ff935c4d.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-ddcb8a791eb78be0.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-0173f00552b8db63.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-6b0dc584197d65ca.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-9683b9a04a433565.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-8e277c6b700feab3.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-e1969211ff164d40.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-45b2f66a178d4904.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-5c4ca86e52b727da.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-94fdb64b4806cacd.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-d3c00e76c029c206.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-2308fb4d3beeba0d.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-2b0bcdee6d565642.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-5eac7ccd2748bd72.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-c7de47e97aa650bf.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-6ffab46e85c867dc.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-9c5b29da37f8ca72.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-a369c45ad55c6532.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-a23a2da11ead94af.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-d68903c8a30efbc1.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-05486108df35cc0e.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-ee50047d9670670f.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-9211a5221822bed5.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-33e3db3e0687bfc3.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-2afcde675a0017f4.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-3a071e4559601805.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-680c2731a505464f.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-1d668da2466c9e75.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-545670859eb42e17.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-689268fc892d7785.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-4068905b672ee190.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-8b58cecee7ea49db.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-afa87f7a82de72b0.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-137360fe26e80299.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-d4d404e6ebb41a02.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-061143fe438e5ae8.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-78dbfb5ba5488827.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-3c8ab15ca28009bf.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-e8b311930f230954.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-72dad41504d2a918.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-be634fc46db5d8e9.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-949f0be12929dca8.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-e804904e85294103.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-d9c3550a504089a7.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-333bc7c48dd5255a.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-b1d7b41290752cb8.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-1d03baea78089250.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-a401af6be71b4681.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-68c75a862db491f1.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-c3ee9aad3769bb65.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-0d8dc9bbb4735b50.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-7136f114f63db777.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-2dc084b192bb64e3.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-080c44995ee02b9a.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-8795a5b58c53f709.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-35c6f48749906827.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-0400e911e43af6d1.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-3b93e9afc257f8ae.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-46353674a1b747c7.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-50412178f659e4ff.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-b12a0a659002ffc6.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-9a5993911409583d.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-61058687e23eca96.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-f25480dca5144ad7.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-ad65a7e5aaddafcd.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-358ff2697b705fef.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-2e38fa3abdbf53b9.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-91a35ecf16b54fa5.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-392a9e58937210d8.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-951c7749ae734855.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-015ed998d9183008.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-8a93450caddc97dc.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-c38fca398bd25128.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-e543f3bebfada9b4.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-80cbde53483c5071.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-2aa4551cc0304559.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-278d380e05397db1.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-cf1659f2c5ffd3d8.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-e27bd3eceff23201.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-30e3153276cb81c3.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-6e8aaf7a461c57cf.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-d0b19d19542fe5a6.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-4c3677a21527e539.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-3173a1a4b69e04f8.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-08b2ac08f7b70e1f.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-9c66edf665945699.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-bca47110ca757928.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-9e4110debb868433.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-39992b6a09d68649.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-b64e93dfba91e529.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-84635a0c56461382.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-e083fb88be053015.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-aa8becbfe94e2bd6.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-59d1709e3cb27f1f.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-4bef34364f1e288e.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-44093b5442812676.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-5b8b470a2be37a78.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-b130511b7bcfdd35.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-c924b46a62c678f1.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-875e25daf8da76fb.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-cd3497d111fa5543.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-da9fe448c42b03c3.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-61961cca7253ecd7.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-d6bfacad3b35a405.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-a39bcbfadba8b007.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-0fea85dd6cad0241.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-8099bd021b449e36.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-47bebcd635ae9196.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-cc5ba03def509162.gif">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-26986e1309d52a72.gif">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-e0d7d6fdd8bd8629.gif">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-67ec064e68421b07.gif">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-055564ffdfaacf95.gif">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-ea394f7a0891631f.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-6346d62b1df5d591.gif">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/5291509-19a3efecf90f5541.gif">
<meta property="og:updated_time" content="2018-03-31T09:49:00.300Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Servlet学习">
<meta name="twitter:description" content="Servlet第一篇【介绍Servlet、HTTP协议、WEB目录结构、编写入门Servlet程序、Servlet生命周期】什么是 Serlvet？Servlet 其实就是一个遵循 Servlet 开发的 java 类。Serlvet 是由服务器调用的，运行在服务器端。 为什么要用到 Serlvet？我们编写 java 程序想要在网上实现 聊天、发帖、这样一些的交互功能，普通的 java 技术是">
<meta name="twitter:image" content="https://upload-images.jianshu.io/upload_images/5291509-896f978f9f50d802.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'TZAS2SFOJR',
      apiKey: 'e2a9cd036eede8026382b302001ec261',
      indexName: 'cloudpai_blogs_search',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://cloudpai.site/2018/03/28/2018-03-28-1/"/>





  <title>Servlet学习 | CloudPai</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-114643720-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">CloudPai</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">个人博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            时间轴
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>




 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://cloudpai.site/2018/03/28/2018-03-28-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CloudPai">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://p4lmrb1gp.bkt.clouddn.com/君名-squashed.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CloudPai">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Servlet学习</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-28T19:43:34+08:00">
                2018-03-28
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2018-03-31T17:49:00+08:00">
                2018-03-31
              </time>
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/28/2018-03-28-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/03/28/2018-03-28-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  20,643
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  82
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <script src="/assets/js/APlayer.min.js"> </script><h1 id="Servlet第一篇【介绍Servlet、HTTP协议、WEB目录结构、编写入门Servlet程序、Servlet生命周期】"><a href="#Servlet第一篇【介绍Servlet、HTTP协议、WEB目录结构、编写入门Servlet程序、Servlet生命周期】" class="headerlink" title="Servlet第一篇【介绍Servlet、HTTP协议、WEB目录结构、编写入门Servlet程序、Servlet生命周期】"></a>Servlet第一篇【介绍Servlet、HTTP协议、WEB目录结构、编写入门Servlet程序、Servlet生命周期】</h1><h2 id="什么是-Serlvet？"><a href="#什么是-Serlvet？" class="headerlink" title="什么是 Serlvet？"></a>什么是 Serlvet？</h2><p>Servlet 其实就是一个<strong>遵循 Servlet 开发的 java 类</strong>。Serlvet 是<strong>由服务器调用的</strong>，<strong>运行在服务器端</strong>。</p>
<h2 id="为什么要用到-Serlvet？"><a href="#为什么要用到-Serlvet？" class="headerlink" title="为什么要用到 Serlvet？"></a>为什么要用到 Serlvet？</h2><p>我们编写 java 程序想要在网上实现 聊天、发帖、这样一些的交互功能，<strong>普通的 java 技术是非常难完成的</strong>。sun 公司就提供了 Serlvet 这种技术供我们使用。</p>
<h2 id="HTTP-协议"><a href="#HTTP-协议" class="headerlink" title="HTTP 协议"></a>HTTP 协议</h2><h3 id="什么是-HTPP-协议"><a href="#什么是-HTPP-协议" class="headerlink" title="什么是 HTPP 协议"></a>什么是 HTPP 协议</h3><blockquote>
<p>超文本传输协议（HTTP，HyperText Transfer Protocol) 是互联网上应用最为广泛的一种网络协议。所有的 WWW 文件都必须遵守这个标准。它是 TCP/IP 协议的一个<strong>应用层协议</strong></p>
</blockquote>
<p>简单来说，<strong>HTTP 协议就是客户端和服务器交互的一种通迅的格式</strong>。</p>
<p>例子: 在浏览器点击一个链接，浏览器就为我打开这个链接的网页。</p>
<p>原理：当在浏览器中点击这个链接的时候，<strong>浏览器会向服务器发送一段文本</strong>，<strong>告诉服务器请求打开的是哪一个网页。服务器收到请求后，就返回一段文本给浏览器，浏览器会将该文本解析，然后显示出来。</strong>这段文本就是遵循 HTTP 协议规范的。</p>
<h3 id="HTTP1-0-和-HTTP1-1-的区别"><a href="#HTTP1-0-和-HTTP1-1-的区别" class="headerlink" title="HTTP1.0 和 HTTP1.1 的区别"></a>HTTP1.0 和 HTTP1.1 的区别</h3><p>HTTP1.0 协议中，客户端与 web 服务器建立连接后，只能获得一个 web 资源【短连接，获取资源后就断开连接】</p>
<p>HTTP1.1 协议，允许客户端与 web 服务器建立连接后，在一个连接上获取多个 web 资源【保持连接】</p>
<h3 id="HTTP-请求"><a href="#HTTP-请求" class="headerlink" title="HTTP 请求"></a>HTTP 请求</h3><p><strong>浏览器向服务器请求某个 web 资源时，称之为浏览器向服务器发送了一个 http 请求。</strong></p>
<p>一个完整 http 请求应该包含三个部分：</p>
<ol>
<li>请求行【描述客户端的<strong>请求方式</strong>、<strong>请求的资源名称</strong>，以及使用的 <strong>HTTP 协议版本号</strong>】</li>
<li>多个消息头【描述客户端请求哪台主机，以及<strong>客户端的一些环境信息</strong>等】</li>
<li>一个空行</li>
</ol>
<h4 id="请求行"><a href="#请求行" class="headerlink" title="请求行"></a>请求行</h4><p>请求行：GET /java.html HTTP/1.1</p>
<p><strong>请求行中的 GET 称之为请求方式</strong>，请求方式有：POST,GET,HEAD,OPTIONS,DELETE,TRACE,PUT。</p>
<p><strong>常用的有：POST,GET</strong></p>
<p>一般来说，当我们<strong>点击超链接，通过地址栏访问都是 get 请求方式</strong>。通过<strong>表单提交的数据一般是 post 方式</strong>。</p>
<p>可以简单理解 <strong>GET 方式用来查询数据</strong>,<strong>POST 方式用来提交数据</strong>，<strong>get 的提交速度比 post 快</strong></p>
<p>GET 方式：在 URL 地址后<strong>附带的参数是有限制的</strong>，其<strong>数据容量通常不能超过 1K</strong>。</p>
<p>POST 方式：可以在<strong>请求的实体内容中向服务器发送数据</strong>，<strong>传送的数据量无限制</strong>。</p>
<h4 id="请求头"><a href="#请求头" class="headerlink" title="请求头"></a>请求头</h4><ul>
<li>Accept: text/html,image/* 【浏览器告诉服务器，它支持的数据类型】</li>
<li>Accept-Charset: ISO-8859-1 【浏览器告诉服务器，它支持哪种<strong>字符集</strong>】</li>
<li>Accept-Encoding: gzip,compress 【浏览器告诉服务器，它支持的<strong>压缩格式</strong>】</li>
<li>Accept-Language: en-us,zh-cn 【浏览器告诉服务器，它的语言环境】</li>
<li>Host: <a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.it315.org%3A80" target="_blank" rel="noopener">www.it315.org:80</a>【浏览器告诉服务器，它的想访问哪台主机】</li>
<li>If-Modified-Since: Tue, 11 Jul 2000 18:23:51 GMT【浏览器告诉服务器，缓存数据的时间】</li>
<li>Referer: <a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.it315.org%2Findex.jsp%25E3%2580%2590%25E6%25B5%258F%25E8%25A7%2588%25E5%2599%25A8%25E5%2591%258A%25E8%25AF%2589%25E6%259C%258D%25E5%258A%25A1%25E5%2599%25A8%25EF%25BC%258C%25E5%25AE%25A2%25E6%2588%25B7%25E6%259C%25BA%25E6%2598%25AF%25E4%25BB%258E%25E9%2582%25A3%25E4%25B8%25AA%25E9%25A1%25B5%25E9%259D%25A2%25E6%259D%25A5%25E7%259A%2584---%2A%2A%25E5%258F%258D%25E7%259B%2597%25E9%2593%25BE%2A%2A" target="_blank" rel="noopener">http://www.it315.org/index.jsp【浏览器告诉服务器，客户机是从那个页面来的 — <strong>反盗链</strong></a>】</li>
<li>8.User-Agent: Mozilla/4.0 (compatible; MSIE 5.5; Windows NT 5.0)【浏览器告诉服务器，浏览器的内核是什么】</li>
<li>Cookie【浏览器告诉服务器，<strong>带来的 Cookie 是什么</strong>】</li>
<li>Connection: close/Keep-Alive 【浏览器告诉服务器，请求完后是断开链接还是保持链接】</li>
<li>Date: Tue, 11 Jul 2000 18:23:51 GMT【浏览器告诉服务器，请求的时间】</li>
</ul>
<hr>
<h3 id="HTTP-响应"><a href="#HTTP-响应" class="headerlink" title="HTTP 响应"></a>HTTP 响应</h3><p>一个 HTTP 响应代表着<strong>服务器向浏览器回送数据</strong></p>
<p>一个完整的 HTTP 响应应该包含四个部分:</p>
<ol>
<li>一个状态行【用于描述<strong>服务器对请求的处理结果。</strong>】</li>
<li>多个消息头【用于描述<strong>服务器的基本信息</strong>，以及<strong>数据的描述</strong>，<strong>服务器通过这些数据的描述信息，可以通知客户端如何处理等一会儿它回送的数据</strong>】</li>
<li>一个空行</li>
<li>实体内容【<strong>服务器向客户端回送的数据</strong>】</li>
</ol>
<h4 id="状态行"><a href="#状态行" class="headerlink" title="状态行"></a>状态行</h4><p>格式： HTTP 版本号　状态码　原因叙述</p>
<p>状态行：HTTP/1.1 200 OK</p>
<p>状态码用于表示<strong>服务器对请求的处理结果</strong>，它是一个<strong>三位的十进制数</strong>。响应状态码分为 5 类</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-896f978f9f50d802.png" alt=""></p>
<h4 id="响应头"><a href="#响应头" class="headerlink" title="响应头"></a>响应头</h4><ul>
<li>Location: <a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.it315.org%2Findex.jsp" target="_blank" rel="noopener">http://www.it315.org/index.jsp</a> 【服务器告诉浏览器<strong>要跳转到哪个页面</strong>】</li>
<li>Server:apache tomcat【服务器告诉浏览器，服务器的型号是什么】</li>
<li>Content-Encoding: gzip 【服务器告诉浏览器<strong>数据压缩的格式</strong>】</li>
<li>Content-Length: 80 【服务器告诉浏览器回送数据的长度】</li>
<li>Content-Language: zh-cn 【服务器告诉浏览器，服务器的语言环境】</li>
<li>Content-Type: text/html; charset=GB2312 【服务器告诉浏览器，<strong>回送数据的类型</strong>】</li>
<li>Last-Modified: Tue, 11 Jul 2000 18:23:51 GMT【服务器告诉浏览器该资源上次更新时间】</li>
<li>Refresh: 1;url=<a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.it315.org" target="_blank" rel="noopener">http://www.it315.org</a>【服务器告诉浏览器要<strong>定时刷新</strong>】</li>
<li>Content-Disposition: attachment; filename=aaa.zip【服务器告诉浏览器<strong>以下载方式打开数据</strong>】</li>
<li>Transfer-Encoding: chunked 【服务器告诉浏览器数据以分块方式回送】</li>
<li>Set-Cookie:SS=Q0=5Lb_nQ; path=/search【服务器告诉浏览器要<strong>保存 Cookie</strong>】</li>
<li>Expires: -1【服务器告诉浏览器<strong>不要设置缓存</strong>】</li>
<li>Cache-Control: no-cache 【服务器告诉浏览器<strong>不要设置缓存</strong>】</li>
<li>Pragma: no-cache 【服务器告诉浏览器<strong>不要设置缓存</strong>】</li>
<li>Connection: close/Keep-Alive 【服务器告诉浏览器连接方式】</li>
<li>Date: Tue, 11 Jul 2000 18:23:51 GMT【服务器告诉浏览器回送数据的时间】</li>
</ul>
<h2 id="Servlet-的作用"><a href="#Servlet-的作用" class="headerlink" title="Servlet 的作用"></a>Servlet 的作用</h2><p>Servlet 带给我们最大的作用就是能够<strong>处理浏览器带来 HTTP 请求，并返回一个响应给浏览器，从而实现浏览器和服务器的交互</strong>。</p>
<hr>
<h2 id="JAVAWEB-目录结构"><a href="#JAVAWEB-目录结构" class="headerlink" title="JAVAWEB 目录结构"></a>JAVAWEB 目录结构</h2><p><img src="https://upload-images.jianshu.io/upload_images/5291509-01ac23b210d5e6df.png" alt=""></p>
<p>以上图说明：</p>
<ul>
<li>bbs 目录代表一个 web 应用</li>
<li>bbs 目录下的 html,jsp 文件可以直接被浏览器访问</li>
<li><strong>WEB-INF 目录下的资源是不能直接被浏览器访问的</strong></li>
<li>web.xml 文件是 web 程序的主要配置文件</li>
<li>所有的 classes 文件都放在 classes 目录下</li>
<li>jar 文件放在 lib 目录下</li>
</ul>
<hr>
<h2 id="实现-Servlet-接口编写-Servlet-程序"><a href="#实现-Servlet-接口编写-Servlet-程序" class="headerlink" title="实现 Servlet 接口编写 Servlet 程序"></a>实现 Servlet 接口编写 Servlet 程序</h2><p>程序我都是由 idea 下写，首先要在 idea 上配置 Tomcat，在我别的博文中有教程！</p>
<h3 id="编写-Servlet-程序的步骤"><a href="#编写-Servlet-程序的步骤" class="headerlink" title="编写 Servlet 程序的步骤"></a>编写 Servlet 程序的步骤</h3><ul>
<li>创建一个自定义类，<strong>实现 Serlvet 接口</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-c713202668573a02.png" alt=""></p>
<ul>
<li><p>我们发现有 5 个方法需要重写，有 init【初始化】，destroy【销毁】,service【服务】,ServletConfig【Servlet 配置】,getServletInfo【Serlvet 信息】。</p>
</li>
<li><p>在此一看，发现 service() 方法是最有可能是写逻辑代码的地方。</p>
</li>
<li><p>首先写一个 hellword 入门先</p>
</li>
<li><p>调用 ServletResponse 对象的方法向浏览器输出 HelloWorld</p>
</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-3f38e89de2a7b0fe.png" alt=""></p>
<ul>
<li>配置 xml 文件，光写了 Servlet 是不行的，Tomcat 还要知道浏览器怎么访问这个 Servlet。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-9cd4572e42d820a6.png" alt=""></p>
<ul>
<li>访问自己写的 Serlvet 程序</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-35d0b4e2530d4d3e.png" alt=""></p>
<hr>
<h2 id="Serlvet-生命周期"><a href="#Serlvet-生命周期" class="headerlink" title="Serlvet 生命周期"></a>Serlvet 生命周期</h2><ul>
<li><p>下面我们看看 Servlet 的生命周期</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-653ff9242cc376b4.png" alt=""></p>
</li>
<li><strong>第一次访问</strong> Servlet，我们发现 <strong>init() 和 service() 都被调用了</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-576b4a66265b68ab.png" alt=""></p>
<ul>
<li><strong>第二次访问</strong> Servlet，<strong>service() 被调用了</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-fe444b9c5d8b08fb.png" alt=""></p>
<ul>
<li>第三次访问 Servlet，<strong>还是 service() 被调用了</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-bcd04668df9d854c.png" alt=""></p>
<ul>
<li>当我们<strong>关闭 Tomcat 服务器</strong>的时候，<strong>destroy() 被调用了！</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-e7bf088691383d6d.png" alt=""></p>
<h3 id="Servlet-生命周期可分为-5-个步骤"><a href="#Servlet-生命周期可分为-5-个步骤" class="headerlink" title="Servlet 生命周期可分为 5 个步骤"></a>Servlet 生命周期可分为 5 个步骤</h3><ol>
<li><strong>加载 Servlet</strong>。当 Tomcat 第一次访问 Servlet 的时候，<strong>Tomcat 会负责创建 Servlet 的实例</strong></li>
<li><strong>初始化</strong>。当 Servlet 被实例化后，Tomcat 会<strong>调用 init() 方法初始化这个对象</strong></li>
<li><strong>处理服务</strong>。当浏览器<strong>访问 Servlet</strong> 的时候，Servlet <strong>会调用 service() 方法处理请求</strong></li>
<li><strong>销毁</strong>。当 Tomcat 关闭时或者检测到 Servlet 要从 Tomcat 删除的时候会自动调用 destroy() 方法，<strong>让该实例释放掉所占的资源</strong>。一个 Servlet 如果长时间不被使用的话，也会被 Tomcat 自动销毁</li>
<li><strong>卸载</strong>。当 Servlet 调用完 destroy() 方法后，等待垃圾回收。如果<strong>有需要再次使用这个 Servlet，会重新调用 init() 方法进行初始化操作</strong>。</li>
</ol>
<ul>
<li>简单总结：<strong>只要访问 Servlet，service() 就会被调用。init() 只有第一次访问 Servlet 的时候才会被调用。destroy() 只有在 Tomcat 关闭的时候才会被调用。</strong></li>
</ul>
<hr>
<h2 id="继承-HttpServlet-编写-Servlet-程序"><a href="#继承-HttpServlet-编写-Servlet-程序" class="headerlink" title="继承 HttpServlet 编写 Servlet 程序"></a>继承 HttpServlet 编写 Servlet 程序</h2><p>在上面我们实现 Servlet 接口，要实现 5 个方法。这样太麻烦了！而 <strong>HttpServlet 类已经实现了 Servlet 接口的所有方法</strong>，编写 Servlet 时，只需要<strong>继承 HttpServlet，重写你需要的方法即可</strong>，并且它在原有 Servlet 接口上<strong>添加了一些与 HTTP 协议处理方法</strong>，它<strong>比 Servlet 接口的功能更为强大</strong>。</p>
<ul>
<li>一般我们开发的时候，都是<strong>重写 doGet() 和 doPost() 方法的</strong>。对于 idea 而言，创建 Servlet 的时候已经帮你重写好了</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-36a4a7fdcf24f063.png" alt=""></p>
<hr>
<h1 id="Servlet-第二篇【Servlet-调用图、Servlet-细节、ServletConfig、ServletContext】"><a href="#Servlet-第二篇【Servlet-调用图、Servlet-细节、ServletConfig、ServletContext】" class="headerlink" title="Servlet 第二篇【Servlet 调用图、Servlet 细节、ServletConfig、ServletContext】"></a>Servlet 第二篇【Servlet 调用图、Servlet 细节、ServletConfig、ServletContext】</h1><h2 id="Servlet-的调用图"><a href="#Servlet-的调用图" class="headerlink" title="Servlet 的调用图"></a>Servlet 的调用图</h2><p>前面我们已经学过了 Servlet 的生命周期了，我们根据 Servlet 的生命周期画出 Servlet 的调用图加深理解</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-cc91a5503313c836.png" alt=""></p>
<h2 id="Servlet-的细节"><a href="#Servlet-的细节" class="headerlink" title="Servlet 的细节"></a>Servlet 的细节</h2><h3 id="一个已经注册的-Servlet-可以被多次映射"><a href="#一个已经注册的-Servlet-可以被多次映射" class="headerlink" title="一个已经注册的 Servlet 可以被多次映射"></a>一个已经注册的 Servlet 可以被多次映射</h3><p><strong>同一个 Servlet 可以被映射到多个 URL 上。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;Demo1&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;zhongfucheng.web.Demo1&lt;/servlet-class&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;Demo1&lt;/servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;/Demo1&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;Demo1&lt;/servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;/ouzicheng&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure>
<p>无论我访问的是 <a href="https://link.jianshu.com?t=http%3A%2F%2Flocalhost%3A8080%2FDemo1" target="_blank" rel="noopener">http://localhost:8080/Demo1</a> 还是 <a href="https://link.jianshu.com?t=http%3A%2F%2Flocalhost%3A8080%2Fouzicheng" target="_blank" rel="noopener">http://localhost:8080/ouzicheng</a>。我访问的都是 Demo1。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-aa81351d3dfaaefe.png" alt=""> <img src="https://upload-images.jianshu.io/upload_images/5291509-63e1e34d6641dcdb.png" alt=""></p>
<h3 id="Servlet-映射的-URL-可以使用通配符"><a href="#Servlet-映射的-URL-可以使用通配符" class="headerlink" title="Servlet 映射的 URL 可以使用通配符"></a>Servlet 映射的 URL 可以使用通配符</h3><p>通配符有两种格式：</p>
<ol>
<li>*. 扩展名</li>
<li>正斜杠（/）开头并以 “/*” 结尾。</li>
</ol>
<p><strong>匹配所有</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-70040f402774ed58.png" alt=""></p>
<p><strong>匹配扩展名为. jsp 的</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-f898ba1886636fe3.png" alt=""></p>
<p>如果<em>. 扩展名和正斜杠（/）开头并以 “/</em>” 结尾两种通配符同时出现，匹配的是哪一个呢？</p>
<ol>
<li><strong>看谁的匹配度高，谁就被选择</strong></li>
<li><code>*.</code>扩展名的优先级最低</li>
</ol>
<p>Servlet 映射的 URL 可以使用通配符和 Servlet 可以被映射到多个 URL 上的作用：</p>
<ol>
<li><strong>隐藏网站是用什么编程语言写的</strong>【.php,.net,.asp 实际上访问的都是同一个资源】</li>
<li>用特定的<strong>后缀声明版权</strong>【公司缩写】</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> &lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;Demo1&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;zhongfucheng.web.Demo1&lt;/servlet-class&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;Demo1&lt;/servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;Demo1&lt;/servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;*.net&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;Demo1&lt;/servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;*.asp&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;Demo1&lt;/servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;*.php&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Servlet-是单例的"><a href="#Servlet-是单例的" class="headerlink" title="Servlet 是单例的"></a>Servlet 是单例的</h3><h4 id="为什么-Servlet-是单例的"><a href="#为什么-Servlet-是单例的" class="headerlink" title="为什么 Servlet 是单例的"></a>为什么 Servlet 是单例的</h4><p><strong>浏览器多次对 Servlet 的请求</strong>，一般情况下，<strong>服务器只创建一个 Servlet 对象</strong>，也就是说，Servlet 对象<strong>一旦创建了</strong>，就会<strong>驻留在内存中，为后续的请求做服务，直到服务器关闭</strong>。</p>
<h4 id="每次访问请求对象和响应对象都是新的"><a href="#每次访问请求对象和响应对象都是新的" class="headerlink" title="每次访问请求对象和响应对象都是新的"></a>每次访问请求对象和响应对象都是新的</h4><p>对于<strong>每次访问请求</strong>，Servlet 引擎都会<strong>创建一个新的 HttpServletRequest 请求对象和一个新的 HttpServletResponse 响应对象</strong>，然后将这两<strong>个对象作为参数传递给它调用的 Servlet 的 service() 方法</strong>，<strong>service 方法再根据请求方式分别调用 doXXX 方法</strong>。</p>
<h4 id="线程安全问题"><a href="#线程安全问题" class="headerlink" title="线程安全问题"></a>线程安全问题</h4><p>当多个用户访问 Servlet 的时候，<strong>服务器会为每个用户创建一个线程</strong>。<strong>当多个用户并发访问 Servlet 共享资源的时候就会出现线程安全问题</strong>。</p>
<p>原则：</p>
<ol>
<li>如果一个<strong>变量需要多个用户共享</strong>，则应当在访问该变量的时候，<strong>加同步机制 synchronized (对象){}</strong></li>
<li>如果一个变量<strong>不需要共享</strong>，则<strong>直接在 doGet() 或者 doPost() 定义</strong>. 这样不会存在线程安全问题</li>
</ol>
<hr>
<h3 id="load-on-startup"><a href="#load-on-startup" class="headerlink" title="load-on-startup"></a>load-on-startup</h3><p>如果在</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-24abd7253fa2664a.png" alt=""> <img src="https://upload-images.jianshu.io/upload_images/5291509-8e9fc5359c25b4d0.png" alt=""></p>
<p>作用：</p>
<ol>
<li>为 web 应用写一个 InitServlet，这个 <strong>servlet 配置为启动时装载</strong>，为整个 web 应用<strong>创建必要的数据库表和数据</strong></li>
<li>完成一些定时的任务【定时写日志，定时备份数据】</li>
</ol>
<hr>
<h3 id="在-web-访问任何资源都是在访问-Servlet"><a href="#在-web-访问任何资源都是在访问-Servlet" class="headerlink" title="在 web 访问任何资源都是在访问 Servlet"></a>在 web 访问任何资源都是在访问 Servlet</h3><p>当你启动 Tomcat，你在网址上输入 <a href="https://link.jianshu.com?t=http%3A%2F%2Flocalhost%3A8080" target="_blank" rel="noopener">http://localhost:8080</a>。为什么会出现 Tomcat 小猫的页面？</p>
<p>这是由<strong>缺省 Servlet 为你服务的</strong>！</p>
<ul>
<li>我们先看一下 web.xml 文件中的配置,<strong>web.xml 文件配置了一个缺省 Servlet</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;default&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;org.apache.catalina.servlets.DefaultServlet&lt;/servlet-class&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;debug&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;0&lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;listings&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;false&lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line"></span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;default&lt;/servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>什么叫做缺省 Servlet？凡是在 web.xml 文件中<strong>找不到匹配的</strong>，它们的访问<strong>请求都将交给缺省 Servlet 处理</strong>，也就是说，<strong>缺省 Servlet 用于处理所有其他 Servlet 都不处理的访问请求</strong></li>
<li>既然我说了在 web 访问任何资源都是在访问 Servlet，那么<strong>我访问静态资源【本地图片，本地 HTML 文件】也是在访问这个缺省 Servlet【DefaultServlet】</strong></li>
<li>证实一下：当我没有手工配置缺省 Servlet 的时候，<strong>访问本地图片是可以访问得到的</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-d500528ce9cbb3de.png" alt=""></p>
<ul>
<li>现在我自己配置一个缺省 Servlet,<strong>Demo1 就是我手工配置的缺省 Servlet，覆盖掉 web.xml 配置的缺省 Servlet</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;Demo1&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;zhongfucheng.web.Demo1&lt;/servlet-class&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line"></span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;Demo1&lt;/servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>下面我继续访问一下刚才的图片，此时输出的是 <strong>Demo1 这个 Servlet 写上的内容了</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-2ec566b5ff935c4d.png" alt=""></p>
<ul>
<li>总结：<strong>无论在 web 中访问什么资源【包括 JSP】，都是在访问 Servlet。</strong>没有手工配置缺省 Servlet 的时候，<strong>你访问静态图片，静态网页，缺省 Servlet 会在你 web 站点中寻找该图片或网页</strong>，如果有就返回给浏览器，没有就报 404 错误</li>
</ul>
<hr>
<h2 id="ServletConfig-对象"><a href="#ServletConfig-对象" class="headerlink" title="ServletConfig 对象"></a>ServletConfig 对象</h2><h3 id="ServletConfig-对象有什么用？"><a href="#ServletConfig-对象有什么用？" class="headerlink" title="ServletConfig 对象有什么用？"></a>ServletConfig 对象有什么用？</h3><blockquote>
<p>通过此对象可以读取 web.xml 中配置的初始化参数。</p>
</blockquote>
<p>现在问题来了，<strong>为什么我们要把参数信息放到 web.xml 文件中呢</strong>？我们可以直接在程序中都可以定义参数信息，<strong>搞到 web.xml 文件中又有什么好处呢</strong>？</p>
<p>好处就是：<strong>能够让你的程序更加灵活</strong>【更换需求，更改配置文件 web.xml 即可，程序代码不用改】</p>
<h3 id="获取-web-xml-文件配置的参数信息"><a href="#获取-web-xml-文件配置的参数信息" class="headerlink" title="获取 web.xml 文件配置的参数信息"></a>获取 web.xml 文件配置的参数信息</h3><ul>
<li>为 Demo1 这个 Servlet 配置一个参数，参数名是 name，值是 zhongfucheng</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;Demo1&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;zhongfucheng.web.Demo1&lt;/servlet-class&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;name&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;zhongfucheng&lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;Demo1&lt;/servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;/Demo1&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>在 Servlet 中获取 ServletConfig 对象，通过 ServletConfig 对象获取在 web.xml 文件配置的参数</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-ddcb8a791eb78be0.png" alt=""></p>
</li>
</ul>
<hr>
<h2 id="ServletContext-对象"><a href="#ServletContext-对象" class="headerlink" title="ServletContext 对象"></a>ServletContext 对象</h2><h3 id="什么是-ServletContext-对象？"><a href="#什么是-ServletContext-对象？" class="headerlink" title="什么是 ServletContext 对象？"></a>什么是 ServletContext 对象？</h3><p>当 Tomcat 启动的时候，就会创建一个 <strong>ServletContext</strong> 对象。它<strong>代表着当前 web 站点</strong></p>
<h3 id="ServletContext-有什么用？"><a href="#ServletContext-有什么用？" class="headerlink" title="ServletContext 有什么用？"></a>ServletContext 有什么用？</h3><ol>
<li>ServletContext 既然代表着当前 web 站点，那么<strong>所有 Servlet 都共享着一个 ServletContext 对象</strong>，所以 <strong>Servlet 之间可以通过 ServletContext 实现通讯</strong>。</li>
<li>ServletConfig 获取的是配置的是单个 Servlet 的参数信息，<strong>ServletContext 可以获取的是配置整个 web 站点的参数信息</strong></li>
<li><strong>利用 ServletContext 读取 web 站点的资源文件</strong></li>
<li>实现 Servlet 的转发【用 ServletContext 转发不多，主要用 request 转发】</li>
</ol>
<h4 id="Servlet-之间实现通讯"><a href="#Servlet-之间实现通讯" class="headerlink" title="Servlet 之间实现通讯"></a>Servlet 之间实现通讯</h4><p>ServletContext 对象可以被称之为<strong>域对象</strong></p>
<p>到这里可能有一个疑问，域对象是什么呢？其实域对象可以简单理解成<strong>一个容器【类似于 Map 集合】</strong></p>
<p>实现 Servlet 之间通讯就要<strong>用到 ServletContext 的 setAttribute(String name,Object obj) 方法</strong>，<br>第一个参数是关键字，第二个参数是你要存储的对象</p>
<ul>
<li>这是 Demo2 的代码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//获取到ServletContext对象</span><br><span class="line">ServletContext servletContext = this.getServletContext();</span><br><span class="line"></span><br><span class="line">String value = &quot;zhongfucheng&quot;;</span><br><span class="line"></span><br><span class="line">//MyName作为关键字，value作为值存进域对象【类型于Map集合】</span><br><span class="line">servletContext.setAttribute(&quot;MyName&quot;, value);</span><br></pre></td></tr></table></figure>
<ul>
<li>这是 Demo3 的代码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//获取ServletContext对象</span><br><span class="line">ServletContext servletContext = this.getServletContext();</span><br><span class="line"></span><br><span class="line">//通过关键字获取存储在域对象的值</span><br><span class="line">String value = (String) servletContext.getAttribute(&quot;MyName&quot;);</span><br><span class="line"></span><br><span class="line">System.out.println(value);</span><br></pre></td></tr></table></figure>
<ul>
<li>访问 Demo3 可以获取 Demo2 存储的信息，从而实现多个 Servlet 之间通讯</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-0173f00552b8db63.png" alt=""></p>
<hr>
<h4 id="获取-web-站点配置的信息"><a href="#获取-web-站点配置的信息" class="headerlink" title="获取 web 站点配置的信息"></a>获取 web 站点配置的信息</h4><p>如果我想要让所有的 Servlet 都能够获取到连接数据库的信息，不可能在 web.xml 文件中每个 Servlet 中都配置一下，这样代码量太大了！并且会显得非常啰嗦冗余。</p>
<ul>
<li>web.xml 文件支持<strong>对整个站点进行配置参数信息</strong>【<strong>所有 Servlet 都可以取到该参数信息</strong>】</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;context-param&gt;</span><br><span class="line">    &lt;param-name&gt;name&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;zhongfucheng&lt;/param-value&gt;</span><br><span class="line">&lt;/context-param&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>Demo4 代码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//获取到ServletContext对象</span><br><span class="line">ServletContext servletContext = this.getServletContext();</span><br><span class="line"></span><br><span class="line">//通过名称获取值</span><br><span class="line">String value = servletContext.getInitParameter(&quot;name&quot;);</span><br><span class="line">System.out.println(value);</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-6b0dc584197d65ca.png" alt=""></p>
<ul>
<li>试一下 Demo3 是否能拿到，相同的代码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//获取到ServletContext对象</span><br><span class="line">ServletContext servletContext = this.getServletContext();</span><br><span class="line"></span><br><span class="line">//通过名称获取值</span><br><span class="line">String value = servletContext.getInitParameter(&quot;name&quot;);</span><br><span class="line">System.out.println(value);</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-9683b9a04a433565.png" alt=""></p>
<hr>
<h4 id="读取资源文件"><a href="#读取资源文件" class="headerlink" title="读取资源文件"></a>读取资源文件</h4><p><strong>第一种方式：</strong></p>
<ul>
<li>现在我要通过 Servlet111 读取 1.png 图片</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-8e277c6b700feab3.png" alt=""></p>
<ul>
<li>按我们以前的方式，代码应该是这样的。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">FileInputStream fileInputStream = new FileInputStream(&quot;1.png&quot;);</span><br><span class="line">System.out.println(fileInputStream);</span><br></pre></td></tr></table></figure>
<ul>
<li>当我们访问的时候，却出错了！说<strong>找不到 1.png 文件</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-e1969211ff164d40.png" alt=""></p>
<ul>
<li>这是为什么呢？我们<strong>以前读取文件的时候，如果程序和文件在同一包名，可以直接通过文件名称获取得到的</strong>！，原因很简单，<strong>以前我们写的程序都是通过 JVM 来运行的，而现在，我们是通过 Tomcat 来运行的</strong></li>
<li>根据 web 的目录规范，Servlet 编译后的 class 文件是存放在 WEB-INF\classes 文件夹中的</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-45b2f66a178d4904.png" alt=""></p>
<ul>
<li>看到这里，我们知道了<strong>要进入 classes 目录中读取文件</strong>，所以我们将代码改成以下方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">FileInputStream fileInputStream = new FileInputStream(&quot;D:\\zhongfucheng\\web\\WEB-INF\\classes\\zhongfucheng\\web\\1.png&quot;);</span><br><span class="line">System.out.println(fileInputStream);</span><br></pre></td></tr></table></figure>
<ul>
<li>再去读取时，就发现可以获取到文件了。</li>
<li>但是现在问题又来了，<strong>我读取文件的时候都要写上绝对路径，这样太不灵活了</strong>。试想一下，如果我将该<strong>读取文件的模块移到其他的 web 站点上</strong>，<strong>我的代码就又要修改了【因为 web 站点的名字不一样】</strong>。</li>
<li>我们通过 <strong>ServletContext 读取就可以避免修改代码的情况</strong>，因为 ServletContext 对象是根据当前 web 站点而生成的</li>
<li>代码如下所示：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//获取到ServletContext对象</span><br><span class="line">ServletContext servletContext = this.getServletContext();</span><br><span class="line"></span><br><span class="line">//调用ServletContext方法获取到读取文件的流</span><br><span class="line">InputStream inputStream = servletContext.getResourceAsStream(&quot;/WEB-INF/classes/zhongfucheng/web/1.png&quot;);</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-5c4ca86e52b727da.png" alt=""></p>
<hr>
<p><strong>第二种方式：</strong></p>
<ul>
<li>如果我的<strong>文件放在 web 目录下</strong>，那么就简单得多了！, <strong>直接通过文件名称就能获取</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-94fdb64b4806cacd.png" alt=""></p>
<ul>
<li>代码如下所示</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//获取到ServletContext对象</span><br><span class="line">ServletContext servletContext = this.getServletContext();</span><br><span class="line"></span><br><span class="line">//调用ServletContext方法获取到读取文件的流</span><br><span class="line">InputStream inputStream = servletContext.getResourceAsStream(&quot;2.png&quot;);</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-d3c00e76c029c206.png" alt=""></p>
<hr>
<p><strong>第三种方式：</strong></p>
<p>通过<strong>类装载器读取资源文件</strong>。</p>
<ul>
<li>我的文件放在了 <strong>src 目录下【也叫做类目录】</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-2308fb4d3beeba0d.png" alt=""></p>
<ul>
<li>代码如下所示</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//获取到类装载器</span><br><span class="line">ClassLoader classLoader = Servlet111.class.getClassLoader();</span><br><span class="line"></span><br><span class="line">//通过类装载器获取到读取文件流</span><br><span class="line">InputStream inputStream = classLoader.getResourceAsStream(&quot;3.png&quot;);</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-2b0bcdee6d565642.png" alt=""></p>
<ul>
<li>我的文件放在了 src 目录下的包下</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-5eac7ccd2748bd72.png" alt=""></p>
<ul>
<li>代码如下，添加包名路径即可。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//获取到类装载器</span><br><span class="line">ClassLoader classLoader = Servlet111.class.getClassLoader();</span><br><span class="line"></span><br><span class="line">//通过类装载器获取到读取文件流</span><br><span class="line">InputStream inputStream = classLoader.getResourceAsStream(&quot;/zhongfucheng/web/1.png&quot;);</span><br></pre></td></tr></table></figure>
<p>原则：<strong>如果文件太大，就不能用类装载器的方式去读取，会导致内存溢出</strong></p>
<h1 id="Servlet-第四篇【request-对象常用方法、应用】"><a href="#Servlet-第四篇【request-对象常用方法、应用】" class="headerlink" title="Servlet 第四篇【request 对象常用方法、应用】"></a>Servlet 第四篇【request 对象常用方法、应用】</h1><h2 id="什么是-HttpServletRequest"><a href="#什么是-HttpServletRequest" class="headerlink" title="什么是 HttpServletRequest"></a>什么是 HttpServletRequest</h2><blockquote>
<p>HttpServletRequest 对象代表客户端的请求，当客户端通过 HTTP 协议访问服务器时，HTTP 请求头中的所有信息都封装在这个对象中，开发人员通过这个对象的方法，可以获得客户这些信息。</p>
</blockquote>
<p>简单来说，<strong>要得到浏览器信息，就找 HttpServletRequest 对象</strong></p>
<h2 id="HttpServletRequest-常用方法"><a href="#HttpServletRequest-常用方法" class="headerlink" title="HttpServletRequest 常用方法"></a>HttpServletRequest 常用方法</h2><h3 id="获得客户机【浏览器】信息"><a href="#获得客户机【浏览器】信息" class="headerlink" title="获得客户机【浏览器】信息"></a>获得客户机【浏览器】信息</h3><ul>
<li><strong>getRequestURL 方法返回客户端发出请求时的完整 URL。</strong></li>
<li>getRequestURI 方法返回请求行中的资源名部分。</li>
<li><strong>getQueryString 方法返回请求行中的参数部分。</strong></li>
<li>getPathInfo 方法返回请求 URL 中的额外路径信息。额外路径信息是请求 URL 中的位于 Servlet 的路径之后和查询参数之前的内容，它以 “/” 开头。</li>
<li><strong>getRemoteAddr 方法返回发出请求的客户机的 IP 地址</strong></li>
<li>getRemoteHost 方法返回发出请求的客户机的完整主机名</li>
<li>getRemotePort 方法返回客户机所使用的网络端口号</li>
<li><strong>getLocalAddr 方法返回 WEB 服务器的 IP 地址。</strong></li>
<li>getLocalName 方法返回 WEB 服务器的主机名</li>
</ul>
<h3 id="获得客户机请求头"><a href="#获得客户机请求头" class="headerlink" title="获得客户机请求头"></a>获得客户机请求头</h3><ul>
<li><strong>getHeader 方法</strong></li>
<li>getHeaders 方法</li>
<li>getHeaderNames 方法</li>
</ul>
<h3 id="获得客户机请求参数-客户端提交的数据"><a href="#获得客户机请求参数-客户端提交的数据" class="headerlink" title="获得客户机请求参数 (客户端提交的数据)"></a>获得客户机请求参数 (客户端提交的数据)</h3><ul>
<li><strong>getParameter 方法</strong></li>
<li><strong>getParameterValues（String name）方法</strong></li>
<li>getParameterNames 方法</li>
<li>getParameterMap 方法</li>
</ul>
<hr>
<h2 id="HttpServletRequest-应用"><a href="#HttpServletRequest-应用" class="headerlink" title="HttpServletRequest 应用"></a>HttpServletRequest 应用</h2><h3 id="防盗链"><a href="#防盗链" class="headerlink" title="防盗链"></a>防盗链</h3><p>什么是防盗链呢？比如：<strong>我现在有海贼王最新的资源，想要看海贼王的要在我的网页上看。现在别的网站的人看到我有海贼王的资源，想要把我的资源粘贴在他自己的网站上。这样我独家的资源就被一个 CTRL+C 和 CTRL+V 抢走了</strong>？而反盗链就是不能被他们 CRTL+C 和 CRTL+V</p>
<ul>
<li>下面我模拟一下场景。现在我首页先有一个超链接，指向着海贼王最新资源</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-c7de47e97aa650bf.png" alt=""></p>
<ul>
<li>当我点进去，就能看到海贼王最新资源了</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-6ffab46e85c867dc.png" alt=""></p>
<ul>
<li>其他的人可以通过复制粘贴我的地址，放到它们的网页上</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-9c5b29da37f8ca72.png" alt=""></p>
<ul>
<li><p>这样我就划不来啦【我的广告你来没看呢！】。<strong>想要看我的资源，就必须经过我的首页点进去看</strong>。</p>
</li>
<li><p>想要实现这样的效果，就要<strong>获取 Referer 这个消息头</strong>，<strong>判断 Referer 是不是从我的首页来的。如果不是从我的首页来的，跳转回我的首页</strong>。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//获取到网页是从哪里来的</span><br><span class="line">String referer = request.getHeader(&quot;Referer&quot;);</span><br><span class="line"></span><br><span class="line">//如果不是从我的首页来或者从地址栏直接访问的，</span><br><span class="line">if ( referer == null || !referer.contains(&quot;localhost:8080/zhongfucheng/index.jsp&quot;) ) &#123;</span><br><span class="line"></span><br><span class="line">    //回到首页去</span><br><span class="line">    response.sendRedirect(&quot;/zhongfucheng/index.jsp&quot;);</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//能执行下面的语句，说明是从我的首页点击进来的，那没问题，照常显示</span><br><span class="line">response.setContentType(&quot;text/html;charset=UTF-8&quot;);</span><br><span class="line">response.getWriter().write(&quot;路飞做了XXXXxxxxxxxxxxxxxxxx&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>首先按正常预想的，<strong>别人从首页点击我的资源，访问我海贼王最新的资源</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-a369c45ad55c6532.png" alt=""></p>
<p>\</p>
<ul>
<li>能够成功访问到资源</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-a23a2da11ead94af.png" alt=""></p>
<ul>
<li>如果我在浏览器直接输入地址【此时 Referer 是为 null 的】，我们来看看</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-d68903c8a30efbc1.png" alt=""></p>
<ul>
<li><strong>跳回到首页上，不能访问到海贼王资源</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-05486108df35cc0e.png" alt=""></p>
<ul>
<li>再试试，如果<strong>别人粘贴了我的资源 url，在它的网页上挂了一个网址呢。</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-ee50047d9670670f.png" alt=""></p>
<ul>
<li>在别人网页上点击的时候</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-9211a5221822bed5.png" alt=""></p>
<ul>
<li><strong>又跳回到了我的首页了。</strong> <img src="https://upload-images.jianshu.io/upload_images/5291509-33e3db3e0687bfc3.png" alt=""></li>
</ul>
<hr>
<h3 id="表单提交数据【通过-post-方式提交数据】"><a href="#表单提交数据【通过-post-方式提交数据】" class="headerlink" title="表单提交数据【通过 post 方式提交数据】"></a>表单提交数据【通过 post 方式提交数据】</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;form action=&quot;/zhongfucheng/Servlet111&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;用户名&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;input type=&quot;text&quot; &gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;密码&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;input type=&quot;password&quot; &gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;性别&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                &lt;input type=&quot;radio&quot; &gt;男</span><br><span class="line">                &lt;input type=&quot;radio&quot; &gt;女</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;爱好&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                &lt;input type=&quot;checkbox&quot; &gt;游泳</span><br><span class="line">                &lt;input type=&quot;checkbox&quot; &gt;跑步</span><br><span class="line">                &lt;input type=&quot;checkbox&quot; &gt;飞翔</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;input type=&quot;hidden&quot; &gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;你的来自于哪里&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                &lt;select &gt;</span><br><span class="line">                    &lt;option value=&quot;广州&quot;&gt;广州&lt;/option&gt;</span><br><span class="line">                    &lt;option value=&quot;深圳&quot;&gt;深圳&lt;/option&gt;</span><br><span class="line">                    &lt;option value=&quot;北京&quot;&gt;北京&lt;/option&gt;</span><br><span class="line">                &lt;/select&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;详细说明:&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                &lt;textarea cols=&quot;30&quot; rows=&quot;2&quot; &gt;&lt;/textarea&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&lt;input type=&quot;reset&quot; value=&quot;重置&quot;&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>在 Servlet111 中获取到提交的数据，代码如下</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//设置request字符编码的格式</span><br><span class="line">request.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line"></span><br><span class="line">//通过html的name属性，获取到值</span><br><span class="line">String username = request.getParameter(&quot;username&quot;);</span><br><span class="line">String password = request.getParameter(&quot;password&quot;);</span><br><span class="line">String gender = request.getParameter(&quot;gender&quot;);</span><br><span class="line"></span><br><span class="line">//复选框和下拉框有多个值，获取到多个值</span><br><span class="line">String[] hobbies = request.getParameterValues(&quot;hobbies&quot;);</span><br><span class="line">String[] address = request.getParameterValues(&quot;address&quot;);</span><br><span class="line"></span><br><span class="line">//获取到文本域的值</span><br><span class="line">String description = request.getParameter(&quot;textarea&quot;);</span><br><span class="line"></span><br><span class="line">//得到隐藏域的值</span><br><span class="line">String hiddenValue = request.getParameter(&quot;aaa&quot;);</span><br><span class="line"></span><br><span class="line">....各种System.out.println().......</span><br></pre></td></tr></table></figure>
<ul>
<li>向表单输入数据</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-2afcde675a0017f4.png" alt=""></p>
<ul>
<li>Servlet111 得到表单带过来的数据，最后的一个数据是隐藏域带过来的。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-3a071e4559601805.png" alt=""></p>
<hr>
<h3 id="超链接方式提交数据"><a href="#超链接方式提交数据" class="headerlink" title="超链接方式提交数据"></a>超链接方式提交数据</h3><p><strong>常见的 get 方式提交数据有</strong>：<strong>使用超链接，sendRedirect()</strong></p>
<p>格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sendRedirect(&quot;servlet的地址?参数名=&quot;+参数值 &amp;&quot;参数名=&quot;+参数值);</span><br></pre></td></tr></table></figure>
<ul>
<li>我们来使用一下，<strong>通过超链接将数据带给浏览器</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;a href=&quot;/zhongfucheng/Servlet111?user&gt;使用超链接将数据带给浏览器&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>在 Servlet111 接收数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//接收以username为参数名带过来的值</span><br><span class="line">String username = request.getParameter(&quot;username&quot;);</span><br><span class="line">System.out.println(username);</span><br></pre></td></tr></table></figure>
<ul>
<li>注意<strong>看浏览器左下角</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-680c2731a505464f.png" alt=""></p>
<ul>
<li>服务器成功接收到浏览器发送过来的数据</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-1d668da2466c9e75.png" alt=""></p>
<ul>
<li>并且，<strong>传输数据明文的出现在浏览器的地址栏上</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-545670859eb42e17.png" alt=""></p>
<ul>
<li><strong>sendRedirect() 和超链接类似，在这里就不赘述了</strong></li>
</ul>
<hr>
<h3 id="解决中文乱码问题"><a href="#解决中文乱码问题" class="headerlink" title="解决中文乱码问题"></a>解决中文乱码问题</h3><p>细心的朋友会发现，我在获取表单数据的时候，有这句代码<code>request.setCharacterEncoding(&quot;UTF-8&quot;);</code>，如果没有这句代码，会发生什么事呢？我们看看。</p>
<ul>
<li>再重新填写数据</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-689268fc892d7785.png" alt=""></p>
<ul>
<li>在服务器查看提交过来的数据，<strong>所有的中文数据都乱码了</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-4068905b672ee190.png" alt=""></p>
<ul>
<li><p>来这里我们来分析一下乱码的原因，在前面的博客中我已经介绍了，Tomcat 服务器默认编码是 ISO 8859-1，而<strong>浏览器使用的是 UTF-8 编码</strong>。浏览器的中文数据提交给服务器，<strong>Tomcat 以 ISO 8859-1 编码对中文编码，当我在 Servlet 读取数据的时候，拿到的当然是乱码。</strong>而我设置 request 的编码为 UTF-8，乱码就解决了。</p>
</li>
<li><p>接下来使用 get 方式传递中文数据，<strong>把表单的方式改成 get 即可</strong></p>
</li>
<li><p>当我们访问的时候，又出现乱码了！</p>
</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-8b58cecee7ea49db.png" alt=""> <img src="https://upload-images.jianshu.io/upload_images/5291509-afa87f7a82de72b0.png" alt=""></p>
<ul>
<li>于是我按照上面的方式，把 request 对象设置编码为 UTF-8 试试</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">request.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">String name = request.getParameter(&quot;name&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>结果还是乱码。这是为什么呢？<strong>我明明已经把编码设置成 UTF-8 了，按照 post 方式，乱码问题已经解决了</strong>！。我们来看看 get 和 post 方式的区别在哪？<strong>为什么 post 方式设置了 request 编码就可以解决乱码问题，而 get 方式不能呢。</strong></p>
</li>
<li><p>首先我们来看一下 post 方法是怎么进行参数传递的。当我们<strong>点击提交按钮的时候，数据封装进了 Form Data 中</strong>，<strong>http 请求中把实体主体带过去了【传输的数据称之为实体主体】</strong>，既然 request 对象封装了 http 请求，所以 <strong>request 对象可以解析到发送过来的数据</strong>，于是只要<strong>把编码设置成 UTF-8 就可以解决乱码问题了</strong>。</p>
</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-137360fe26e80299.png" alt=""></p>
<ul>
<li>而 get 方式不同，它的<strong>数据是从消息行带过去的，没有封装到 request 对象里面</strong>，所以使用 request 设置编码是无效的。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-d4d404e6ebb41a02.png" alt=""></p>
<ul>
<li>要解决 get 方式乱码问题也不难，我们既然知道 Tomcat 默认的编码是 ISO 8859-1，那么 <strong>get 方式由消息体带过去给浏览器的时候肯定是用 ISO 8859-1 编码了</strong>。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//此时得到的数据已经是被ISO 8859-1编码后的字符串了，这个是乱码</span><br><span class="line">String name = request.getParameter(&quot;username&quot;);</span><br><span class="line"></span><br><span class="line">//乱码通过反向查ISO 8859-1得到原始的数据</span><br><span class="line">byte[] bytes = name.getBytes(&quot;ISO8859-1&quot;);</span><br><span class="line"></span><br><span class="line">//通过原始的数据，设置正确的码表，构建字符串</span><br><span class="line">String value = new String(bytes, &quot;UTF-8&quot;);</span><br></pre></td></tr></table></figure>
<p>上面的代码有些难理解，我画张图说明一下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-061143fe438e5ae8.png" alt=""></p>
<ul>
<li>经过我们手工转换，再来访问一下</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-78dbfb5ba5488827.png" alt=""></p>
<ul>
<li><p>好的，成功解决掉乱码问题了。</p>
</li>
<li><p>除了手工转换，<strong>get 方式还可以改 Tomcat 服务器的配置来解决乱码，但是不推荐使用，这样不灵活。</strong>“</p>
</li>
<li><p>我们都知道 <strong>Tomcat 默认的编码是 ISO 8859-1, 如果在 Tomcat 服务器的配置下改成是 UTF-8 的编码，那么就解决服务器在解析数据的时候造成乱码问题了</strong></p>
</li>
<li><p>在 8080 端口的 Connector 上加入<code>URIEncoding=&quot;utf-8&quot;</code>，设置 Tomcat 的访问该端口时的编码为 utf-8，从而解决乱码，<strong>这种改法是固定使用 UTF-8 编码的</strong></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; </span><br><span class="line">           connectionTimeout=&quot;20000&quot; </span><br><span class="line">           redirectPort=&quot;8443&quot; URIEncoding=&quot;utf-8&quot;/&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>设置了编码后，没有做任何手工转换，成功拿到数据</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-3c8ab15ca28009bf.png" alt=""></p>
<p>、</p>
<ul>
<li>当然也有另一种改服务器编码的方式。设置 Tomcat 的访问该端口时的编码<strong>为页面的编码，这种改法是随着页面的编码而变</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; </span><br><span class="line">           connectionTimeout=&quot;20000&quot; </span><br><span class="line">           redirectPort=&quot;8443&quot; useBodyEncodingForURI=&quot;true&quot; /&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>设置编码为 UTF-8</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">request.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">String name = request.getParameter(&quot;name&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>再次访问</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-e8b311930f230954.png" alt=""></p>
<ul>
<li><p><strong>手写超链接如果附带中文参数问题，要 URL 重写，在 JSP 博客中会讲到</strong></p>
</li>
<li><p>总结：</p>
</li>
<li><p>post 方式直接改 request 对象的编码</p>
</li>
<li><p>get 方式需要手工转换编码</p>
</li>
<li><p><strong>get 方式也可以修改 Tomcat 服务器的编码，不推荐，因为会太依赖服务器了！</strong></p>
</li>
<li><p><strong>提交数据能用 post 就用 post</strong></p>
</li>
</ul>
<hr>
<h3 id="实现转发"><a href="#实现转发" class="headerlink" title="实现转发"></a>实现转发</h3><p>之前讲过使用 response 的 sendRedirect() 可以<strong>实现重定向，做到的功能是页面跳转</strong>，使用 request 的 getRequestDispatcher.forward(request,response) <strong>实现转发，做到的功能也是页面跳转</strong>，他们有什么区别呢？现在我先来说下转发</p>
<ul>
<li>代码如下所示</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//获取到requestDispatcher对象，跳转到index.jsp</span><br><span class="line">RequestDispatcher requestDispatcher = request.getRequestDispatcher(&quot;/index.jsp&quot;);</span><br><span class="line"></span><br><span class="line">//调用requestDispatcher对象的forward()实现转发,传入request和response方法</span><br><span class="line">requestDispatcher.forward(request, response);</span><br></pre></td></tr></table></figure>
<ul>
<li>访问 Servlet111</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-72dad41504d2a918.png" alt=""></p>
<ul>
<li><p>上面已经说了，可以<strong>通过 sendRedirect() 重定向可以在资源尾部添加参数提交数据给服务器。那么转发能不能提交数据给服务器呢？</strong></p>
</li>
<li><p><strong>答案明显是可以的，并且使用这种方法非常频繁</strong></p>
</li>
<li><p>在讲 ServletContext 的时候，<strong>曾经说过 Servlet 之间可以通过 ServletContext 实现通讯，ServletContext 也能称之为域对象</strong>。而 <strong>request 也可以称之为域对象</strong>，只不过 <strong>ServletContext 的域是整个 web 应用，而 request 的域仅仅代表一次 http 请求</strong></p>
</li>
<li><p>下面我们来使用 request 实现 Servlet 之间的通讯，Servlet111 代码</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//以username为关键字存zhongfucheng值</span><br><span class="line">request.setAttribute(&quot;username&quot;, &quot;zhongfucheng&quot;);</span><br><span class="line"></span><br><span class="line">//获取到requestDispatcher对象</span><br><span class="line">RequestDispatcher requestDispatcher = request.getRequestDispatcher(&quot;/Servlet222&quot;);</span><br><span class="line"></span><br><span class="line">//调用requestDispatcher对象的forward()实现转发,传入request和response方法</span><br><span class="line">requestDispatcher.forward(request, response);</span><br></pre></td></tr></table></figure>
<ul>
<li>Servlet222 代码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//获取到存进request对象的值</span><br><span class="line">String userName = (String) request.getAttribute(&quot;username&quot;);</span><br><span class="line"></span><br><span class="line">//在浏览器输出该值</span><br><span class="line">response.getWriter().write(&quot;i am :&quot;+userName);</span><br></pre></td></tr></table></figure>
<ul>
<li>访问 Servlet111 看下效果</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-be634fc46db5d8e9.png" alt=""></p>
<ul>
<li><p>如上图所示，<strong>Servlet222 成功拿到了 request 对象在 Servlet111 存进的数据</strong>。</p>
</li>
<li><p>现在问题又来了，我们可以<strong>使用 ServletContext 和 request 实现 Servlet 之间的通讯，那么我们用哪一种呢</strong>？一般的原则：<strong>可以使用 request 就尽可能使用 request</strong>。因为 ServletContext 代表着整个 web 应用，使用 ServletContext 会消耗大量的资源，而 <strong>request 对象会随着请求的结束而结束，资源会被回收</strong>。<strong>使用 request 域进行 Servlet 之间的通讯在开发中是非常频繁的</strong>。</p>
</li>
</ul>
<h3 id="转发的时序图"><a href="#转发的时序图" class="headerlink" title="转发的时序图"></a>转发的时序图</h3><p><img src="https://upload-images.jianshu.io/upload_images/5291509-949f0be12929dca8.png" alt=""></p>
<h3 id="请求转发的细节"><a href="#请求转发的细节" class="headerlink" title="请求转发的细节"></a>请求转发的细节</h3><ul>
<li><p>如果在<strong>调用 forward 方法之前</strong>，在 <strong>Servlet 程序中写入的部分内容已经被真正地传送到了客户端</strong>，forward 方法将抛出 IllegalStateException 异常。 也就是说：<strong>不要在转发之前写数据给浏览器</strong></p>
</li>
<li><p>我们来试试是不是真的会出现异常。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">OutputStream outputStream = response.getOutputStream();</span><br><span class="line">outputStream.write(&quot;--------------------------------------------&quot;.getBytes());</span><br><span class="line"></span><br><span class="line">//关闭流，确保让数据到浏览器中</span><br><span class="line">outputStream.close();</span><br><span class="line"></span><br><span class="line">//跳转</span><br><span class="line">request.getRequestDispatcher(&quot;/Foot&quot;).forward(request, response);</span><br></pre></td></tr></table></figure>
<ul>
<li>访问的时候，看到浏览器可以输出数据，Tomcat 后台抛出了异常</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-e804904e85294103.png" alt=""></p>
<ul>
<li>如果在调用 forward 方法之前向 Servlet 引擎的缓冲区中写入了内容，<strong>只要写入到缓冲区中的内容还没有被真正输出到客户端</strong>，forward 方法就可以被正常执行，<strong>原来写入到输出缓冲区中的内容将被清空</strong>，但是，<strong>已写入到 HttpServletResponse 对象中的响应头字段信息保持有效</strong>。</li>
</ul>
<h3 id="转发和重定向的区别"><a href="#转发和重定向的区别" class="headerlink" title="转发和重定向的区别"></a>转发和重定向的区别</h3><h4 id="实际发生位置不同，地址栏不同"><a href="#实际发生位置不同，地址栏不同" class="headerlink" title="实际发生位置不同，地址栏不同"></a>实际发生位置不同，地址栏不同</h4><ul>
<li>转发是发生在服务器的<ul>
<li><strong>转发是由服务器进行跳转的</strong>，细心的朋友会发现，在转发的时候，<strong>浏览器的地址栏是没有发生变化的</strong>，在我访问 Servlet111 的时候，即使跳转到了 Servlet222 的页面，浏览器的地址还是 Servlet111 的。也就是说<strong>浏览器是不知道该跳转的动作，转发是对浏览器透明的</strong>。通过上面的转发时序图我们也可以发现，<strong>实现转发只是一次的 http 请求</strong>，<strong>一次转发中 request 和 response 对象都是同一个</strong>。这也解释了，为什么可以使用 <strong>request 作为域对象进行 Servlet 之间的通讯。</strong></li>
</ul>
</li>
<li>重定向是发生在浏览器的<ul>
<li><strong>重定向是由浏览器进行跳转的</strong>，进行重定向跳转的时候，<strong>浏览器的地址会发生变化的</strong>。曾经介绍过：实现重定向的原理是由 response 的状态码和 Location 头组合而实现的。<strong>这是由浏览器进行的页面跳转</strong>实现重定向<strong>会发出两个 http 请求</strong>，<strong>request 域对象是无效的，因为它不是同一个 request 对象</strong></li>
</ul>
</li>
</ul>
<h4 id="用法不同"><a href="#用法不同" class="headerlink" title="用法不同"></a>用法不同</h4><p>很多人都搞不清楚转发和重定向的时候，<strong>资源地址究竟怎么写</strong>。有的时候要把应用名写上，有的时候不用把应用名写上。很容易把人搞晕。记住一个原则：<strong>给服务器用的直接从资源名开始写，给浏览器用的要把应用名写上</strong></p>
<ul>
<li>request.getRequestDispatcher(“/ 资源名 URI”).forward(request,response)<ul>
<li><strong>转发时 “/“ 代表的是本应用程序的根目录【zhongfucheng】</strong></li>
</ul>
</li>
<li>response.send(“/web 应用 / 资源名 URI”);<ul>
<li><strong>重定向时 “/“ 代表的是 webapps 目录</strong></li>
</ul>
</li>
</ul>
<h4 id="能够去往的-URL-的范围不一样"><a href="#能够去往的-URL-的范围不一样" class="headerlink" title="能够去往的 URL 的范围不一样"></a>能够去往的 URL 的范围不一样</h4><ul>
<li><strong>转发是服务器跳转只能去往当前 web 应用的资源</strong></li>
<li><strong>重定向是服务器跳转，可以去往任何的资源</strong></li>
</ul>
<h4 id="传递数据的类型不同"><a href="#传递数据的类型不同" class="headerlink" title="传递数据的类型不同"></a>传递数据的类型不同</h4><ul>
<li><strong>转发的 request 对象可以传递各种类型的数据，包括对象</strong></li>
<li><strong>重定向只能传递字符串</strong></li>
</ul>
<h4 id="跳转的时间不同"><a href="#跳转的时间不同" class="headerlink" title="跳转的时间不同"></a>跳转的时间不同</h4><ul>
<li><strong>转发时：执行到跳转语句时就会立刻跳转</strong></li>
<li><strong>重定向：整个页面执行完之后才执行跳转</strong></li>
</ul>
<hr>
<h3 id="转发和重定向使用哪一个？"><a href="#转发和重定向使用哪一个？" class="headerlink" title="转发和重定向使用哪一个？"></a>转发和重定向使用哪一个？</h3><p>根据上面说明了转发和重定向的区别也可以很容易概括出来<strong>。转发是带着转发前的请求的参数的。重定向是新的请求</strong>。</p>
<p>典型的应用场景：</p>
<ol>
<li>转发: 访问 Servlet 处理业务逻辑，然后 forward 到 jsp 显示处理结果，浏览器里 URL 不变</li>
<li>重定向: 提交表单，处理成功后 redirect 到另一个 jsp，防止表单重复提交，浏览器里 URL 变了</li>
</ol>
<hr>
<h3 id="RequestDispatcher-再说明"><a href="#RequestDispatcher-再说明" class="headerlink" title="RequestDispatcher 再说明"></a>RequestDispatcher 再说明</h3><p>RequestDispatcher 对象调用 forward() 可以实现转发上面已经说过了。RequestDispatcher 还有另外一个方法 <strong>include()</strong>，该方法可以实现包含，有什么用呢？</p>
<p>我们在写网页的时候，一般<strong>网页的头部和尾部是不需要改变的</strong>。如果我们<strong>多个地方使用 Servlet 输出网头和网尾的话，需要把代码重新写一遍</strong>。而使用 RequestDispatcher 的 <strong>include() 方法就可以实现包含网头和网尾的效果了</strong>。</p>
<ul>
<li>我们来操作吧！现在我有网头和网尾的 Servlet</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-d9c3550a504089a7.png" alt=""></p>
<ul>
<li>使用 Servlet111 将网头和网尾包含</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">request.getRequestDispatcher(&quot;/Head&quot;).include(request, response);</span><br><span class="line"></span><br><span class="line">response.getWriter().write(&quot;--------------------------------------------&quot;);</span><br><span class="line"></span><br><span class="line">request.getRequestDispatcher(&quot;/Foot&quot;).include(request, response);</span><br></pre></td></tr></table></figure>
<ul>
<li>访问一下 Servlet111, 成功把网头和网尾包含了</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-333bc7c48dd5255a.png" alt=""></p>
<hr>
<h1 id="Servlet-第五篇【介绍会话技术、Cookie-的-API、详解、应用】"><a href="#Servlet-第五篇【介绍会话技术、Cookie-的-API、详解、应用】" class="headerlink" title="Servlet 第五篇【介绍会话技术、Cookie 的 API、详解、应用】"></a>Servlet 第五篇【介绍会话技术、Cookie 的 API、详解、应用】</h1><h2 id="什么是会话技术"><a href="#什么是会话技术" class="headerlink" title="什么是会话技术"></a>什么是会话技术</h2><blockquote>
<p>基本概念: 指用户开一个浏览器，<strong>访问一个网站, 只要不关闭该浏览器，不管该用户点击多少个超链接，访问多少资源，直到用户关闭浏览器，整个这个过程我们称为一次会话</strong>.</p>
</blockquote>
<hr>
<h2 id="为什么我们要使用会话技术？"><a href="#为什么我们要使用会话技术？" class="headerlink" title="为什么我们要使用会话技术？"></a>为什么我们要使用会话技术？</h2><p>会话跟踪技术可以解决我们很多很多问题。</p>
<ul>
<li>在论坛登陆的时候，<strong>很多时候会有一个小框框问你是否要自动登陆，当你下次登陆的时候就不用输入密码了</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-b1d7b41290752cb8.png" alt=""></p>
<ul>
<li><strong>根据我以前浏览过的商品，猜我喜欢什么商品</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-1d03baea78089250.png" alt=""></p>
<hr>
<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p><strong>会话跟踪技术有 Cookie 和 Session</strong>，<strong>Cookie 技术是先出现的</strong>。我们先讲 Cookie 技术吧。</p>
<h3 id="什么是-Cookie"><a href="#什么是-Cookie" class="headerlink" title="什么是 Cookie"></a>什么是 Cookie</h3><blockquote>
<p>Cookie 是由 W3C 组织提出，最早由 netscape 社区发展的一种机制</p>
</blockquote>
<ul>
<li>网页之间的<strong>交互是通过 HTTP 协议传输数据的，</strong>而 Http 协议是<strong>无状态的协议</strong>。无状态的协议是什么意思呢？<strong>一旦数据提交完后，浏览器和服务器的连接就会关闭，再次交互的时候需要重新建立新的连接</strong>。</li>
<li>服务器无法确认用户的信息，于是乎，W3C 就提出了：<strong>给每一个用户都发一个通行证，无论谁访问的时候都需要携带通行证，这样服务器就可以从通行证上确认用户的信息</strong>。通行证就是 Cookie</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-a401af6be71b4681.png" alt=""></p>
<hr>
<p>Cookie 的流程：浏览器访问服务器，<strong>如果服务器需要记录该用户的状态，就使用 response 向浏览器发送一个 Cookie，浏览器会把 Cookie 保存起来。当浏览器再次访问服务器的时候，浏览器会把请求的网址连同 Cookie 一同交给服务器</strong>。</p>
<h3 id="Cookie-API"><a href="#Cookie-API" class="headerlink" title="Cookie API"></a>Cookie API</h3><ul>
<li>Cookie 类用于创建一个 Cookie 对象</li>
<li>response 接口中定义了一个 addCookie 方法，它用于在其响应头中增加一个相应的 Set-Cookie 头字段</li>
<li>request 接口中定义了一个 getCookies 方法，它用于获取客户端提交的 Cookie</li>
</ul>
<p>常用的 Cookie 方法：</p>
<ul>
<li>public Cookie(String name,String value)</li>
<li>setValue 与 getValue 方法</li>
<li>setMaxAge 与 getMaxAge 方法</li>
<li>setPath 与 getPath 方法</li>
<li>setDomain 与 getDomain 方法</li>
<li>getName 方法</li>
</ul>
<h3 id="简单使用-Cookie"><a href="#简单使用-Cookie" class="headerlink" title="简单使用 Cookie"></a>简单使用 Cookie</h3><ul>
<li>创建 Cookie 对象，发送 Cookie 给浏览器、</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//设置response的编码</span><br><span class="line">response.setContentType(&quot;text/html;charset=UTF-8&quot;);</span><br><span class="line"></span><br><span class="line">//创建Cookie对象，指定名称和值</span><br><span class="line">Cookie cookie = new Cookie(&quot;username&quot;, &quot;zhongfucheng&quot;);</span><br><span class="line"></span><br><span class="line">//向浏览器给一个Cookie</span><br><span class="line">response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">response.getWriter().write(&quot;我已经向浏览器发送了一个Cookie&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>浏览器本身没有任何 Cookie</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-68c75a862db491f1.png" alt=""></p>
<ul>
<li>访问 Servlet1，<strong>再回到文件夹中，还是没有发现 Cookie，这是为什么呢？我明明向浏览器发送了一个 Cookie 的</strong>。</li>
<li>原来<strong>发送 Cookie 给浏览器是需要设置 Cookie 的时间的</strong>。在给浏览器之前，设置一下 Cookie 的时间</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//设置Cookie的时间</span><br><span class="line">cookie.setMaxAge(1000);</span><br></pre></td></tr></table></figure>
<ul>
<li>再次访问，已经发现文件夹中多了个 Cookie 的文本了</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-c3ee9aad3769bb65.png" alt=""></p>
<hr>
<h3 id="Cookie-细节"><a href="#Cookie-细节" class="headerlink" title="Cookie 细节"></a>Cookie 细节</h3><h4 id="Cookie-不可跨域名性"><a href="#Cookie-不可跨域名性" class="headerlink" title="Cookie 不可跨域名性"></a>Cookie 不可跨域名性</h4><ul>
<li>很多人在初学的时候可能有一个疑问：在访问 Servlet 的时候浏览器<strong>是不是把所有的 Cookie 都带过去给服务器</strong>，<strong>会不会修改了别的网站的 Cookie</strong></li>
<li>答案是否定的。Cookie 具有不可跨域名性。浏览器判断<strong>一个网站是否能操作另一个网站的 Cookie 的依据是域名</strong>。所以一般来说，<strong>当我访问 baidu 的时候，浏览器只会把 baidu 颁发的 Cookie 带过去，而不会带上 google 的 Cookie。</strong></li>
</ul>
<h4 id="Cookie-保存中文"><a href="#Cookie-保存中文" class="headerlink" title="Cookie 保存中文"></a>Cookie 保存中文</h4><ul>
<li>上面我们的例子保存的是英文字符，下面我们来看下保存中文字符会怎么样。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">response.setContentType(&quot;text/html;charset=UTF-8&quot;);</span><br><span class="line">PrintWriter printWriter = response.getWriter();</span><br><span class="line"></span><br><span class="line">String name = &quot;中国&quot;;</span><br><span class="line">Cookie cookie = new Cookie(&quot;country&quot;, name);</span><br><span class="line">cookie.setMaxAge(2000);</span><br><span class="line">response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">printWriter.write(&quot;我颁发了一个Cookie，值保存的是中文数据&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>访问 Servlet1，好吧。出异常了！</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-0d8dc9bbb4735b50.png" alt=""></p>
<ul>
<li><strong>中文属于 Unicode 字符，英文数据 ASCII 字符，中文占 4 个字符或者 3 个字符，英文占 2 个字符。</strong></li>
<li>解决：<strong>Cookie 使用 Unicode 字符时需要对 Unicode 字符进行编码。</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//对Unicode字符进行编码</span><br><span class="line">Cookie cookie = new Cookie(&quot;country&quot;, URLEncoder.encode(name, &quot;UTF-8&quot;));</span><br></pre></td></tr></table></figure>
<ul>
<li>再次访问 Servlet1，已经把 Cookie 成功颁发给浏览器了</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-7136f114f63db777.png" alt=""> <img src="https://upload-images.jianshu.io/upload_images/5291509-2dc084b192bb64e3.png" alt=""></p>
<ul>
<li>我们发现 Cookie 保存在硬盘的中文数据是经过编码的，那么我们在<strong>取出 Cookie 的时候要对中文数据进行解码</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Cookie[] cookies = request.getCookies();</span><br><span class="line">for (int i = 0; cookies != null &amp;&amp; i &lt; cookies.length; i++) &#123;</span><br><span class="line">    String name = cookies[i].getName();</span><br><span class="line"></span><br><span class="line">    //经过URLEncoding就要URLDecoding</span><br><span class="line">    String value = URLDecoder.decode(cookies[i].getValue(), &quot;UTF-8&quot;);</span><br><span class="line"></span><br><span class="line">    printWriter.write(name + &quot;------&quot; + value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>取出存进 Cookie 的值</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-080c44995ee02b9a.png" alt=""></p>
<hr>
<h4 id="Cookie-的有效期"><a href="#Cookie-的有效期" class="headerlink" title="Cookie 的有效期"></a>Cookie 的有效期</h4><p><strong>Cookie 的有效期是通过 setMaxAge() 来设置的</strong>。</p>
<ul>
<li>如果 MaxAge 为<strong>正数</strong>，<strong>浏览器会把 Cookie 写到硬盘中，只要还在 MaxAge 秒之前，登陆网站时该 Cookie 就有效</strong>【不论关闭了浏览器还是电脑】</li>
<li>如果 MaxAge 为<strong>负数</strong>，<strong>Cookie 是临时性的，仅在本浏览器内有效</strong>，关闭浏览器 Cookie 就失效了，Cookie 不会写到硬盘中。Cookie 默认值就是 - 1。这也就为什么在我第一个例子中，如果我没设置 Cookie 的有效期，在硬盘中就找不到对应的文件。</li>
<li>如果 MaxAge 为 <strong>0</strong>，则表示<strong>删除该 Cookie</strong>。Cookie 机制没有提供删除 Cookie 对应的方法，把 MaxAge 设置为 0 等同于删除 Cookie</li>
</ul>
<hr>
<h4 id="Cookie-的修改和删除"><a href="#Cookie-的修改和删除" class="headerlink" title="Cookie 的修改和删除"></a>Cookie 的修改和删除</h4><ul>
<li>上面我们已经知道了 Cookie 机制没有提供删除 Cookie 的方法。其实细心点我们可以发现，Cookie 机制也没有提供修改 Cookie 的方法。那么我们<strong>怎么修改 Cookie 的值呢</strong>？</li>
<li>Cookie 存储的方式<strong>类似于 Map 集合</strong>，如下图所示</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-8795a5b58c53f709.png" alt=""></p>
<ul>
<li><p><strong>Cookie 的名称相同，通过 response 添加到浏览器中，会覆盖原来的 Cookie</strong>。</p>
</li>
<li><p>以 country 为名保存的是 %E4%B8%AD%E5%9B%BD，下面我<strong>再以 country 为名，把值改变一下</strong>。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-35c6f48749906827.png" alt=""></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">String name = &quot;看完博客就点赞&quot;;</span><br><span class="line"></span><br><span class="line">//对Unicode字符进行编码</span><br><span class="line">Cookie cookie = new Cookie(&quot;country&quot;, URLEncoder.encode(name, &quot;UTF-8&quot;));</span><br></pre></td></tr></table></figure>
<ul>
<li>再次查看 Cookie 的时候，<strong>值已经改变了，但是文件还是那一份</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-0400e911e43af6d1.png" alt=""></p>
<ul>
<li>现在我要删除该 Cookie，<strong>把 MaxAge 设置为 0，并添加到浏览器中即可</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">String name = &quot;看完博客就点赞&quot;;</span><br><span class="line"></span><br><span class="line">//对Unicode字符进行编码</span><br><span class="line">Cookie cookie = new Cookie(&quot;country&quot;, URLEncoder.encode(name, &quot;UTF-8&quot;));</span><br><span class="line"></span><br><span class="line">//一定不要忘记添加到浏览器中</span><br><span class="line">cookie.setMaxAge(0);</span><br><span class="line">response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">printWriter.write(&quot;我删除了该Cookie&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>访问 Servlet，在硬盘已经找不到 Cookie 的文件了！</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-3b93e9afc257f8ae.png" alt=""> <img src="https://upload-images.jianshu.io/upload_images/5291509-46353674a1b747c7.png" alt=""></p>
<ul>
<li><p>注意：删除，修改 Cookie 时，<strong>新建的 Cookie 除了 value、maxAge 之外的所有属性都要与原 Cookie 相同</strong>。否则浏览器将<strong>视为不同的 Cookie，不予覆盖，导致删除修改失败</strong>！</p>
</li>
<li><p>我们来试验一下把。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">String name = &quot;看完博客就点赞&quot;;</span><br><span class="line"></span><br><span class="line">//对Unicode字符进行编码</span><br><span class="line">Cookie cookie = new Cookie(&quot;country&quot;, URLEncoder.encode(name, &quot;UTF-8&quot;));</span><br><span class="line"></span><br><span class="line">//一定不要忘记添加到浏览器中</span><br><span class="line">cookie.setMaxAge(10000);</span><br><span class="line">response.addCookie(cookie);</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-50412178f659e4ff.png" alt=""></p>
<ul>
<li>上面新建了一个 Cookie，我<strong>修改下 Cookie 的其他属性，再删除，看能否把 Cookie 删除掉</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//一定不要忘记添加到浏览器中</span><br><span class="line"></span><br><span class="line">cookie.setPath(&quot;/ouzicheng&quot;);</span><br><span class="line">cookie.setMaxAge(0);</span><br><span class="line">response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">printWriter.write(&quot;删除一个Cookie&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>结果 Cookie 还在硬盘中</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-b12a0a659002ffc6.png" alt=""></p>
<hr>
<h4 id="Cookie-的域名"><a href="#Cookie-的域名" class="headerlink" title="Cookie 的域名"></a>Cookie 的域名</h4><p>Cookie 的 <strong>domain 属性决定运行访问 Cookie 的域名。domain 的值规定为 “. 域名”</strong></p>
<ul>
<li><p>Cookie 的隐私安全机制决定 Cookie 是不可跨域名的。也就是说 <a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> 和 <a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.google.com" target="_blank" rel="noopener">www.google.com</a> 之间的 Cookie 是互不交接的。<strong>即使是同一级域名，不同二级域名也不能交接</strong>，也就是说：<a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.goole.com" target="_blank" rel="noopener">www.goole.com</a> 和 <a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.image.goole.com" target="_blank" rel="noopener">www.image.goole.com</a> 的 Cookie 也不能访问</p>
</li>
<li><p>我在本地上<strong>配置了 3 个虚拟主机</strong>，localhost,<a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.zhongfucheng.com%2Cwww.image.zhongfucheng.com" target="_blank" rel="noopener">www.zhongfucheng.com,www.image.zhongfucheng.com</a>【如果不知道怎么配置，在我 Tomcat 的博客有】</p>
</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-9a5993911409583d.png" alt=""> <img src="https://upload-images.jianshu.io/upload_images/5291509-61058687e23eca96.png" alt=""></p>
<ul>
<li>我用 <a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.zhongfucheng.com" target="_blank" rel="noopener">www.zhongfucheng.com</a> 域名发送了一个 Cookie 给浏览器</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Cookie cookie = new Cookie(&quot;name&quot;, &quot;zhongfucheng&quot;);</span><br><span class="line">cookie.setMaxAge(1000);</span><br><span class="line">response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">printWriter.write(&quot;使用www.zhongfucheng.com域名添加了一个Cookie&quot;);</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-f25480dca5144ad7.png" alt=""></p>
<ul>
<li>首先，证明了 Cookie 不可跨名性，localhost 域名拿不到 <a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.zhongfucheng.com" target="_blank" rel="noopener">www.zhongfucheng.com</a> 颁发给浏览器的 Cookie</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-ad65a7e5aaddafcd.png" alt=""></p>
<ul>
<li>再使用 <a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.image.zhongfucheng.com" target="_blank" rel="noopener">www.image.zhongfucheng.com</a> 域名访问, <strong>证明即使一级域名相同，二级域名不同，也不能获取到 Cookie</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-358ff2697b705fef.png" alt=""></p>
<ul>
<li>当然，使用 <a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.zhongfucheng.com" target="_blank" rel="noopener">www.zhongfucheng.com</a> 当然能获取到 Cookie，Cookie 通过请求头带给服务器</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-2e38fa3abdbf53b9.png" alt=""></p>
<ul>
<li>现在我希望<strong>一级域名相同的网页 Cookie 之间可以相互访问。也就是说 <a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.image.zhongfucheng.com" target="_blank" rel="noopener">www.image.zhongfucheng.com</a> 可以获取到 <a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.zhongfucheng.com" target="_blank" rel="noopener">www.zhongfucheng.com</a> 的 Cookie</strong> 就需要使用到 domain 方法。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Cookie cookie = new Cookie(&quot;name&quot;, &quot;ouzicheng&quot;);</span><br><span class="line">cookie.setMaxAge(1000);</span><br><span class="line">cookie.setDomain(&quot;.zhongfucheng.com&quot;);</span><br><span class="line">response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">printWriter.write(&quot;使用www.zhongfucheng.com域名添加了一个Cookie,只要一级是zhongfucheng.com即可访问&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>使用 <a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.zhongfucheng.com" target="_blank" rel="noopener">www.zhongfucheng.com</a> 发布一个 Cookie</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-91a35ecf16b54fa5.png" alt=""></p>
</li>
<li>使用 <a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.image.zhongfucheng.com" target="_blank" rel="noopener">www.image.zhongfucheng.com</a> 域名访问一下。<strong>发现可以获取到 Cookie 了</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-392a9e58937210d8.png" alt=""></p>
<hr>
<h4 id="Cookie-的路径"><a href="#Cookie-的路径" class="headerlink" title="Cookie 的路径"></a>Cookie 的路径</h4><p><strong>Cookie 的 path 属性决定允许访问 Cookie 的路径</strong></p>
<ul>
<li><p>一般地，<strong>Cookie 发布出来，整个网页的资源都可以使用。现在我只想 Servlet1 可以获取到 Cookie，其他的资源不能获取</strong>。</p>
</li>
<li><p>使用 Servlet2 颁发一个 Cookie 给浏览器, 设置路径为 “/Servlet1”。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Cookie cookie = new Cookie(&quot;username&quot;, &quot;java&quot;);</span><br><span class="line">cookie.setPath(&quot;/Servlet1&quot;);</span><br><span class="line">cookie.setMaxAge(1000);</span><br><span class="line">response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">printWriter.write(&quot;该Cookie只有Servlet1获取得到&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 Servlet3 访问服务器，看看浏览器是否把 Cookie 带上。显然，浏览器访问 Servlet3 并没有把 Cookie 带上。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-951c7749ae734855.png" alt=""></p>
<ul>
<li>使用 Servlet1 访问服务器，看看浏览器是否把 Cookie 带上。答案是肯定的！</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-015ed998d9183008.png" alt=""></p>
<hr>
<h4 id="Cookie-的安全属性"><a href="#Cookie-的安全属性" class="headerlink" title="Cookie 的安全属性"></a>Cookie 的安全属性</h4><ul>
<li>HTTP 协议不仅仅是无状态的，而且是不安全的！如果不希望 Cookie 在非安全协议中传输，可以<strong>设置 Cookie 的 secure 属性为 true，浏览器只会在 HTTPS 和 SSL 等安全协议中传输该 Cookie</strong>。</li>
<li>当然了，设置 secure 属性不会将 Cookie 的内容加密。如果想要保证安全，最好使用 md5 算法加密【后面有】。</li>
</ul>
<hr>
<h3 id="Cookie-的应用"><a href="#Cookie-的应用" class="headerlink" title="Cookie 的应用"></a>Cookie 的应用</h3><h4 id="显示用户上次访问的时间"><a href="#显示用户上次访问的时间" class="headerlink" title="显示用户上次访问的时间"></a>显示用户上次访问的时间</h4><ul>
<li><p>其实就是<strong>每次登陆的时候，取到 Cookie 保存的值，再更新下 Cookie 的值</strong>。</p>
</li>
<li><p>访问 Serlvet 有两种情况</p>
</li>
<li><p>第一次访问</p>
</li>
<li><p>已经访问过了</p>
</li>
<li><p>全部代码如下：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">SimpleDateFormat simpleDateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line">response.setContentType(&quot;text/html;charset=UTF-8&quot;);</span><br><span class="line">PrintWriter printWriter = response.getWriter();</span><br><span class="line"></span><br><span class="line">//获取网页上所有的Cookie</span><br><span class="line">Cookie[] cookies = request.getCookies();</span><br><span class="line"></span><br><span class="line">//判断Cookie的值是否为空</span><br><span class="line">String cookieValue = null;</span><br><span class="line">for (int i = 0; cookies != null &amp;&amp; i &lt; cookies.length; i++) &#123;</span><br><span class="line"></span><br><span class="line">    //获取到以time为名的Cookie</span><br><span class="line">    if (cookies[i].getName().equals(&quot;time&quot;)) &#123;</span><br><span class="line">        printWriter.write(&quot;您上次登陆的时间是：&quot;);</span><br><span class="line">        cookieValue = cookies[i].getValue();</span><br><span class="line">        printWriter.write(cookieValue);</span><br><span class="line"></span><br><span class="line">        cookies[i].setValue(simpleDateFormat.format(new Date()));</span><br><span class="line">        response.addCookie(cookies[i]);</span><br><span class="line"></span><br><span class="line">        //既然已经找到了就可以break循环了</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//如果Cookie的值是空的，那么就是第一次访问</span><br><span class="line">if (cookieValue == null) &#123;</span><br><span class="line">    //创建一个Cookie对象，日期为当前时间</span><br><span class="line">    Cookie cookie = new Cookie(&quot;time&quot;, simpleDateFormat.format(new Date()));</span><br><span class="line"></span><br><span class="line">    //设置Cookie的生命期</span><br><span class="line">    cookie.setMaxAge(20000);</span><br><span class="line"></span><br><span class="line">    //response对象回送Cookie给浏览器</span><br><span class="line">    response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">    printWriter.write(&quot;您是第一次登陆啊！&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>按照正常的逻辑来写，程序流程应该是这样子的。先创建 Cookie 对象，回送 Cookie 给浏览器。再遍历 Cookie，更新 Cookie 的值</strong>。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-8a93450caddc97dc.png" alt=""></p>
<ul>
<li><p>但是，按照上面的逻辑是做不到的！<strong>因为每次访问 Servlet 的时候都会覆盖原来的 Cookie，取到 Cookie 的值永远都是当前时间，而不是上次保存的时间。</strong></p>
</li>
<li><p>我们换一个逻辑写：<strong>先检查（遍历）所有 Cookie 有没有我要的，如果得不到我想要的 Cookie，Cookie 的值是 null，那么就是第一次登陆</strong>，于是就有了上面的代码了。</p>
</li>
<li><p>我们来看下效果吧！当我第一次登陆的时候</p>
</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-c38fca398bd25128.png" alt=""></p>
<ul>
<li>Cookie 保存在硬盘中。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-e543f3bebfada9b4.png" alt=""></p>
<ul>
<li>再次访问 Servlet。<strong>明显地，取到的就是 Cookie 的值</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-80cbde53483c5071.png" alt=""></p>
<hr>
<h4 id="显示上次浏览过商品"><a href="#显示上次浏览过商品" class="headerlink" title="显示上次浏览过商品"></a>显示上次浏览过商品</h4><ul>
<li>我就以书籍为例子了！<strong>首先设计 Book 对象</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private String id ;</span><br><span class="line">private String name ;</span><br><span class="line">private String author;</span><br><span class="line"></span><br><span class="line">public Book() &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public Book(String id, String name, String author) &#123;</span><br><span class="line">    this.id = id;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.author = author;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...各种set、get方法</span><br></pre></td></tr></table></figure>
<ul>
<li>设计一个简单的数据库存储数据。就用 <strong>LinkedHashMap 集合【根据商品的 id 找书籍所以用 Map，删改较多所以用 Linked】</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private static LinkedHashMap&lt;String, Book&gt; linkedHashMap = new LinkedHashMap();</span><br><span class="line"></span><br><span class="line">//简化开发复杂度，book的id和商品的id相同</span><br><span class="line">static &#123;</span><br><span class="line">    linkedHashMap.put(&quot;1&quot;, new Book(&quot;1&quot;, &quot;javaweb&quot;, &quot;zhong&quot;));</span><br><span class="line">    linkedHashMap.put(&quot;2&quot;, new Book(&quot;2&quot;, &quot;java&quot;, &quot;fu&quot;));</span><br><span class="line">    linkedHashMap.put(&quot;3&quot;, new Book(&quot;3&quot;, &quot;oracle&quot;, &quot;cheng&quot;));</span><br><span class="line">    linkedHashMap.put(&quot;4&quot;, new Book(&quot;4&quot;, &quot;mysql&quot;, &quot;ou&quot;));</span><br><span class="line">    linkedHashMap.put(&quot;5&quot;, new Book(&quot;5&quot;, &quot;ajax&quot;, &quot;zi&quot;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//获取到所有书籍</span><br><span class="line">public static LinkedHashMap getAll() &#123;</span><br><span class="line">    return linkedHashMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>显示网页上所有的书籍【首页】</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">printWriter.write(&quot;网页上所有的书籍：&quot;+&quot;&lt;br/&gt;&quot;);</span><br><span class="line"></span><br><span class="line">//拿到数据库所有的书</span><br><span class="line">LinkedHashMap&lt;String, Book&gt; linkedHashMap = DB.getAll();</span><br><span class="line">Set&lt;Map.Entry&lt;String, Book&gt;&gt; entry = linkedHashMap.entrySet();</span><br><span class="line"></span><br><span class="line">//显示所有的书到网页上</span><br><span class="line">for (Map.Entry&lt;String, Book&gt; stringBookEntry : entry) &#123;</span><br><span class="line">    Book book = stringBookEntry.getValue();</span><br><span class="line">    printWriter.write(book.getId() +&quot;           &quot;+ book.getName()+&quot;&lt;br/&gt;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-2aa4551cc0304559.png" alt=""></p>
<ul>
<li>接着，我们要做的就是<strong>给显示的书籍挂上一个超链接</strong>，当用户点击想看的书籍时，就<strong>跳转到该书籍的详细信息页面</strong></li>
<li><strong>超链接应该把书的 id 传递过去，不然处理页面是不知道用户想看的是哪一本书的！</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//显示所有的书到网页上</span><br><span class="line">for (Map.Entry&lt;String, Book&gt; stringBookEntry : entry) &#123;</span><br><span class="line">    Book book = stringBookEntry.getValue();</span><br><span class="line">    printWriter.write(&quot;&lt;a href=&apos;/ouzicheng/Servlet2?id=&quot; + book.getId() + &quot;&apos;&apos;target=_blank&apos; +&quot; + book.getName() + &quot;&lt;/a&gt;&quot;);</span><br><span class="line">    printWriter.write(&quot;&lt;br/&gt;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-278d380e05397db1.png" alt=""></p>
<ul>
<li><strong>接收 id，找到用户想要看哪一本书，输出该书的详细信息</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">String id = request.getParameter(&quot;id&quot;);</span><br><span class="line"></span><br><span class="line">//由于book的id和商品的id是一致的。获取到用户点击的书</span><br><span class="line">Book book = (Book) DB.getAll().get(id);</span><br><span class="line"></span><br><span class="line">//输出书的详细信息</span><br><span class="line">printWriter.write(&quot;书的编号是：&quot; + book.getId()+&quot;&lt;br/&gt;&quot;);</span><br><span class="line">printWriter.write(&quot;书的名称是：&quot; + book.getName()+&quot;&lt;br/&gt;&quot;);</span><br><span class="line">printWriter.write(&quot;书的作者是：&quot; + book.getAuthor()+&quot;&lt;br/&gt;&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>点击想要的书籍。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-cf1659f2c5ffd3d8.png" alt=""></p>
<ul>
<li>得到书籍的详细信息</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-e27bd3eceff23201.png" alt=""></p>
<ul>
<li><p>既然用户点击了书籍，那么<strong>服务器就应该颁发 Cookie 给浏览器，记住用户点击了该书籍</strong></p>
</li>
<li><p>现在问题来了，Cookie 的值应该是什么呢？试想一下，<strong>待会还要把浏览过的书籍显示出来，所以用书籍的 id 是最好不过的</strong>。想到了用书籍的 id 作为 Cookie 的值，我们还要定义一些规则！</p>
</li>
<li><p>我们可能有非常多的书籍，不可能把用户浏览过的书籍都显示出来。所以我们定义<strong>只能显示 3 本浏览过的书籍</strong></p>
</li>
<li><p>书籍的 id 都是数字，<strong>如果不做任何修改，存到 Cookie 里边可能就是 231，345，123 此类的数字</strong>，这样<strong>取出某一个 id 的时候就十分费劲并且后面还要判断该书是否存在 Cookie 里边了</strong>，所以我们要把存储到 Cookie 的书籍 id 分割起来。所以<strong>我们定义”_“作为分隔符</strong></p>
</li>
<li><p>按上面的应用，<strong>我们的逻辑应该是：先遍历下 Cookie，看下有没有我们想要的 Cookie。如果找到想要的 Cookie，那就取出 Cookie 的值</strong></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">String bookHistory = null;</span><br><span class="line">Cookie[] cookies = request.getCookies();</span><br><span class="line">for (int i = 0; cookies != null &amp;&amp; i &lt; cookies.length; i++) &#123;</span><br><span class="line">    if (cookies[i].getName().equals(&quot;bookHistory&quot;)) &#123;</span><br><span class="line">        bookHistory = cookies[i].getValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>取出了 Cookie 的值也分几种情况</p>
<ol>
<li>Cookie 的值为 null【直接把传入进来的 id 当做是 Cookie 的值】</li>
<li>Cookie 的值长度有 3 个了【把排在最后的 id 去掉，把传进来的 id 排在最前边】</li>
<li>Cookie 的值已经包含有传递进来的 id 了【把已经包含的 id 先去掉，再把 id 排在最前面】</li>
<li>Cookie 的值就只有 1 个或 2 个，直接把 id 排在最前边</li>
</ol>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">if (bookHistory == null) &#123;</span><br><span class="line">    return id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//如果Cookie的值不是null的，那么就分解Cookie的得到之前的id。</span><br><span class="line">String[] strings = bookHistory.split(&quot;\\_&quot;);</span><br><span class="line"></span><br><span class="line">//为了增删容易并且还要判断id是否存在于该字符串内-----我们使用LinkedList集合装载分解出来的id</span><br><span class="line">List list = Arrays.asList(strings);</span><br><span class="line">LinkedList&lt;String&gt; linkedList = new LinkedList&lt;&gt;();</span><br><span class="line">linkedList.addAll(list);</span><br><span class="line"></span><br><span class="line">if (linkedList.contains(id)) &#123;</span><br><span class="line">    linkedList.remove(id);</span><br><span class="line">    linkedList.addFirst(id);</span><br><span class="line">&#125;else &#123;</span><br><span class="line">    if (linkedList.size() &gt;= 3) &#123;</span><br><span class="line">        linkedList.removeLast();</span><br><span class="line">        linkedList.addFirst(id);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        linkedList.addFirst(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>这么折腾完了，我们的 Cookie 值就在 LinkedList 集合里边了。接下来，<strong>我们要做的就是把集合中的值取出来，拼接成一个字符串</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">StringBuffer stringBuffer = new StringBuffer();</span><br><span class="line"></span><br><span class="line">//遍历LinkedList集合，添加个下划线“_”</span><br><span class="line">for (String s : linkedList) &#123;</span><br><span class="line">    stringBuffer.append(s + &quot;_&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//最后一个元素后面就不需要下划线了</span><br><span class="line">return stringBuffer.deleteCharAt(stringBuffer.length() - 1).toString();</span><br></pre></td></tr></table></figure>
<ul>
<li>好的，我们现在已经完成了 Cookie 值了。接下来设置 Cookie 的生命周期，回送给浏览器即可</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">String bookHistory = makeHistory(request, id);</span><br><span class="line">Cookie cookie = new Cookie(&quot;bookHistory&quot;, bookHistory);</span><br><span class="line">cookie.setMaxAge(30000);</span><br><span class="line">response.addCookie(cookie);</span><br></pre></td></tr></table></figure>
<ul>
<li>既然我们已经把 Cookie 回送给浏览器了。那么接下来我们<strong>就在首页上获取 Cookie 的值，显示用户浏览过什么商品就行了</strong>！</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">printWriter.write(&quot;您曾经浏览过的商品：&quot;);</span><br><span class="line">printWriter.write(&quot;&lt;br/&gt;&quot;);</span><br><span class="line"></span><br><span class="line">//显示用户浏览过的商品</span><br><span class="line">Cookie[] cookies = request.getCookies();</span><br><span class="line">for (int i = 0; cookies != null &amp;&amp; i &lt; cookies.length; i++) &#123;</span><br><span class="line"></span><br><span class="line">    if (cookies[i].getName().equals(&quot;bookHistory&quot;)) &#123;</span><br><span class="line"></span><br><span class="line">        //获取到的bookHistory是2_3_1之类的</span><br><span class="line">        String bookHistory = cookies[i].getValue();</span><br><span class="line"></span><br><span class="line">        //拆解成每一个id值</span><br><span class="line">        String[] ids = bookHistory.split(&quot;\\_&quot;);</span><br><span class="line"></span><br><span class="line">        //得到每一个id值</span><br><span class="line">        for (String id : ids) &#123;</span><br><span class="line"></span><br><span class="line">            //通过id找到每一本书</span><br><span class="line">            Book book = linkedHashMap.get(id);</span><br><span class="line"></span><br><span class="line">            printWriter.write(book.getName());</span><br><span class="line">            printWriter.write(&quot;&lt;br/&gt;&quot;);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>好的，我们来试验一下吧！！，第一次访问首页，并没有浏览过的商品</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-30e3153276cb81c3.png" alt=""></p>
<ul>
<li>当我点击 javaweb 书籍再访问首页的时候</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-6e8aaf7a461c57cf.png" alt=""></p>
<ul>
<li>再点击 ajax 然后访问首页</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-d0b19d19542fe5a6.png" alt=""></p>
<ul>
<li>再点击 javaweb 然后访问首页</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-4c3677a21527e539.png" alt=""></p>
<ul>
<li>点击 oracle 然后访问首页</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-3173a1a4b69e04f8.png" alt=""></p>
<ul>
<li>好的，经过测试，该程序应该没有什么问题了！</li>
</ul>
<hr>
<h1 id="Servlet-第六篇【Session-介绍、API、生命周期、应用、与-Cookie-区别】"><a href="#Servlet-第六篇【Session-介绍、API、生命周期、应用、与-Cookie-区别】" class="headerlink" title="Servlet 第六篇【Session 介绍、API、生命周期、应用、与 Cookie 区别】"></a>Servlet 第六篇【Session 介绍、API、生命周期、应用、与 Cookie 区别】</h1><h2 id="什么是-Session"><a href="#什么是-Session" class="headerlink" title="什么是 Session"></a>什么是 Session</h2><blockquote>
<p>Session 是另一种记录浏览器状态的机制。不同的是 Cookie 保存在浏览器中，Session 保存在服务器中。用户使用浏览器访问服务器的时候，服务器把用户的信息以某种的形式记录在服务器，这就是 Session</p>
</blockquote>
<p>如果说 Cookie 是检查用户身上的”通行证 “来确认用户的身份，那么 Session 就是通过检查服务器上的” 客户明细表“来确认用户的身份的。Session 相当于在服务器中建立了一份“客户明细表”。</p>
<h2 id="为什么要使用-Session-技术？"><a href="#为什么要使用-Session-技术？" class="headerlink" title="为什么要使用 Session 技术？"></a>为什么要使用 Session 技术？</h2><p><strong>Session 比 Cookie 使用方便，Session 可以解决 Cookie 解决不了的事情【Session 可以存储对象，Cookie 只能存储字符串。】。</strong></p>
<h2 id="Session-API"><a href="#Session-API" class="headerlink" title="Session API"></a>Session API</h2><ul>
<li>long getCreationTime();【获取 Session 被创建时间】</li>
<li><strong>String getId();【获取 Session 的 id】</strong></li>
<li>long getLastAccessedTime();【返回 Session 最后活跃的时间】</li>
<li>ServletContext getServletContext();【获取 ServletContext 对象】</li>
<li><strong>void setMaxInactiveInterval(int var1);【设置 Session 超时时间】</strong></li>
<li><strong>int getMaxInactiveInterval();【获取 Session 超时时间】</strong></li>
<li><strong>Object getAttribute(String var1);【获取 Session 属性</strong>】</li>
<li>Enumeration</li>
<li><strong>void setAttribute(String var1, Object var2);【设置 Session 属性】</strong></li>
<li><strong>void removeAttribute(String var1);【移除 Session 属性】</strong></li>
<li><strong>void invalidate();【销毁该 Session】</strong></li>
<li>boolean isNew();【该 Session 是否为新的】</li>
</ul>
<hr>
<h2 id="Session-作为域对象"><a href="#Session-作为域对象" class="headerlink" title="Session 作为域对象"></a>Session 作为域对象</h2><p>从上面的 API 看出，Session 有着 request 和 ServletContext 类似的方法。其实 <strong>Session 也是一个域对象</strong>。Session 作为一种记录浏览器状态的机制，<strong>只要 Session 对象没有被销毁，Servlet 之间就可以通过 Session 对象实现通讯</strong></p>
<ul>
<li>我们来试试吧，在 Servlet4 中设置 Session 属性</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//得到Session对象</span><br><span class="line">HttpSession httpSession = request.getSession();</span><br><span class="line"></span><br><span class="line">//设置Session属性</span><br><span class="line">httpSession.setAttribute(&quot;name&quot;, &quot;看完博客就要点赞！！&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>在 Servlet5 中获取到 Session 存进去的属性</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//获取到从Servlet4的Session存进去的值</span><br><span class="line">HttpSession httpSession = request.getSession();</span><br><span class="line">String value = (String) httpSession.getAttribute(&quot;name&quot;);</span><br><span class="line">System.out.println(value);</span><br></pre></td></tr></table></figure>
<ul>
<li>访问 Servlet4，再访问 Servlet5</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-08b2ac08f7b70e1f.png" alt=""></p>
<ul>
<li>一般来讲，当我们要存进的是<strong>用户级别的数据就用 Session</strong>，那什么是用户级别呢？<strong>只要浏览器不关闭，希望数据还在，就使用 Session 来保存</strong>。</li>
</ul>
<h2 id="Session-的生命周期和有效期"><a href="#Session-的生命周期和有效期" class="headerlink" title="Session 的生命周期和有效期"></a>Session 的生命周期和有效期</h2><ul>
<li><p>Session 在用户<strong>第一次访问服务器 Servlet，jsp 等动态资源就会被自动创建，Session 对象保存在内存里</strong>，这也就为什么上面的例子可以<strong>直接使用 request 对象获取得到 Session 对象</strong>。</p>
</li>
<li><p>如果访问 HTML,IMAGE 等静态资源 Session 不会被创建。</p>
</li>
<li><p>Session 生成后，只要用户继续访问，服务器就会更新 Session 的最后访问时间，无论<strong>是否对 Session 进行读写，服务器都会认为 Session 活跃了一次</strong>。</p>
</li>
<li><p>由于会有越来越多的用户访问服务器，因此 Session 也会越来越多。<strong>为了防止内存溢出，服务器会把长时间没有活跃的 Session 从内存中删除，这个时间也就是 Session 的超时时间</strong>。</p>
</li>
<li><p>Session 的超时时间默认是 30 分钟，有三种方式可以对 Session 的超时时间进行修改</p>
</li>
<li><p><strong>第一种方式：</strong>在 tomcat/conf/web.xml 文件中设置，时间值为 20 分钟，<strong>所有的 WEB 应用都有效</strong></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;session-config&gt;</span><br><span class="line">    &lt;session-timeout&gt;20&lt;/session-timeout&gt;</span><br><span class="line">&lt;/session-config&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-9c66edf665945699.png" alt=""></p>
<ul>
<li><strong>第二种方式：</strong>在单个的 web.xml 文件中设置，对单个 web 应用有效，<strong>如果有冲突，以自己的 web 应用为准</strong>。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;session-config&gt;</span><br><span class="line">    &lt;session-timeout&gt;20&lt;/session-timeout&gt;</span><br><span class="line">&lt;/session-config&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>第三种方式：</strong>通过 setMaxInactiveInterval() 方法设置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//设置Session最长超时时间为60秒，这里的单位是秒</span><br><span class="line">httpSession.setMaxInactiveInterval(60);</span><br><span class="line"></span><br><span class="line">System.out.println(httpSession.getMaxInactiveInterval());</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-bca47110ca757928.png" alt=""></p>
<ul>
<li>Session 的有效期与 Cookie 的是不同的</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-9e4110debb868433.png" alt=""></p>
<hr>
<h2 id="使用-Session-完成简单的购物功能"><a href="#使用-Session-完成简单的购物功能" class="headerlink" title="使用 Session 完成简单的购物功能"></a>使用 Session 完成简单的购物功能</h2><ul>
<li>我们还是以书籍为例，所以可以 copy“显示浏览过的商品 “例子部分的代码。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">response.setContentType(&quot;text/html;charset=UTF-8&quot;);</span><br><span class="line">PrintWriter printWriter = response.getWriter();</span><br><span class="line"></span><br><span class="line">printWriter.write(&quot;网页上所有的书籍：&quot; + &quot;&lt;br/&gt;&quot;);</span><br><span class="line"></span><br><span class="line">//拿到数据库所有的书</span><br><span class="line">LinkedHashMap&lt;String, Book&gt; linkedHashMap = DB.getAll();</span><br><span class="line">Set&lt;Map.Entry&lt;String, Book&gt;&gt; entry = linkedHashMap.entrySet();</span><br><span class="line"></span><br><span class="line">//显示所有的书到网页上</span><br><span class="line">for (Map.Entry&lt;String, Book&gt; stringBookEntry : entry) &#123;</span><br><span class="line"></span><br><span class="line">    Book book = stringBookEntry.getValue();</span><br><span class="line"></span><br><span class="line">    String url = &quot;/ouzicheng/Servlet6?id=&quot; + book.getId();</span><br><span class="line">    printWriter.write(book.getName());</span><br><span class="line">    printWriter.write(&quot;&lt;a href=&apos;&quot; + url + &quot;&apos;&gt;购买&lt;/a&gt;&quot;);</span><br><span class="line">    printWriter.write(&quot;&lt;br/&gt;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>在购物车页面上，获取到用户想买的书籍【用户可能不单想买一本书，于是乎，就用一个 List 容器装载书籍】，有了：<strong>先遍历 Cookie，再判断是否是第一次访问 Servlet 的逻辑思路</strong>，我们就可以先获取到 Session 的属性，如果 Session 的属性为 null，那么就是还没有该属性</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//得到用户想买书籍的id</span><br><span class="line">String id = request.getParameter(&quot;id&quot;);</span><br><span class="line"></span><br><span class="line">//根据书籍的id找到用户想买的书</span><br><span class="line">Book book = (Book) DB.getAll().get(id);</span><br><span class="line"></span><br><span class="line">//获取到Session对象</span><br><span class="line">HttpSession httpSession = request.getSession();</span><br><span class="line"></span><br><span class="line">//由于用户可能想买多本书的，所以我们用一个容器装着书籍</span><br><span class="line">List list = (List) httpSession.getAttribute(&quot;list&quot;);</span><br><span class="line">if (list == null) &#123;</span><br><span class="line"></span><br><span class="line">    list = new ArrayList();</span><br><span class="line"></span><br><span class="line">    //设置Session属性</span><br><span class="line">    httpSession.setAttribute(&quot;list&quot;,list);</span><br><span class="line">&#125;</span><br><span class="line">//把书籍加入到list集合中</span><br><span class="line">list.add(book);</span><br></pre></td></tr></table></figure>
<ul>
<li>按我们正常的逻辑思路：先创建一个 ArrayList 对象，把书加到 list 集合中，然后设置 Session 的属性。<strong>这样是行不通的</strong>。每次 Servlet 被访问的时候都会创建一个 ArrayList 集合，书籍会被分发到不同的 ArrayList 中去。所以下面的代码是不行的！</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//得到用户想买书籍的id</span><br><span class="line">String id = request.getParameter(&quot;id&quot;);</span><br><span class="line"></span><br><span class="line">//根据书籍的id找到用户想买的书</span><br><span class="line">Book book = (Book) DB.getAll().get(id);</span><br><span class="line"></span><br><span class="line">//获取到Session对象</span><br><span class="line">HttpSession httpSession = request.getSession();</span><br><span class="line"></span><br><span class="line">//创建List集合</span><br><span class="line">List list = new ArrayList();</span><br><span class="line">list.add(book);</span><br><span class="line"></span><br><span class="line">httpSession.setAttribute(&quot;list&quot;, list);</span><br></pre></td></tr></table></figure>
<ul>
<li>既然用户已经购买了书籍，那么也应该给提供页面显示用户购买过哪些书籍</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//得到用户想买书籍的id</span><br><span class="line">String id = request.getParameter(&quot;id&quot;);</span><br><span class="line"></span><br><span class="line">//根据书籍的id找到用户想买的书</span><br><span class="line">Book book = (Book) DB.getAll().get(id);</span><br><span class="line"></span><br><span class="line">//获取到Session对象</span><br><span class="line">HttpSession httpSession = request.getSession();</span><br><span class="line"></span><br><span class="line">//由于用户可能想买多本书的，所以我们用一个容器装着书籍</span><br><span class="line">List list = (List) httpSession.getAttribute(&quot;list&quot;);</span><br><span class="line">if (list == null) &#123;</span><br><span class="line"></span><br><span class="line">    list = new ArrayList();</span><br><span class="line"></span><br><span class="line">    //设置Session属性</span><br><span class="line">    httpSession.setAttribute(&quot;list&quot;,list);</span><br><span class="line">&#125;</span><br><span class="line">//把书籍加入到list集合中</span><br><span class="line">list.add(book);</span><br><span class="line"></span><br><span class="line">String url = &quot;/ouzicheng/Servlet7&quot;;</span><br><span class="line">response.sendRedirect(url);</span><br></pre></td></tr></table></figure>
<ul>
<li>列出用户购买过的书籍</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//要得到用户购买过哪些书籍，得到Session的属性遍历即可</span><br><span class="line">HttpSession httpSession = request.getSession();</span><br><span class="line">List&lt;Book&gt; list = (List) httpSession.getAttribute(&quot;list&quot;);</span><br><span class="line"></span><br><span class="line">if (list == null || list.size() == 0) &#123;</span><br><span class="line">    printWriter.write(&quot;对不起，你还没有买过任何商品&quot;);</span><br><span class="line"></span><br><span class="line">&#125; else &#123;</span><br><span class="line">    printWriter.write(&quot;您购买过以下商品：&quot;);</span><br><span class="line">    printWriter.write(&quot;&lt;br/&gt;&quot;);</span><br><span class="line">    for (Book book : list) &#123;</span><br><span class="line">        printWriter.write(book.getName());</span><br><span class="line">        printWriter.write(&quot;&lt;br/&gt;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>效果如下</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-39992b6a09d68649.png" alt=""></p>
<hr>
<h2 id="Session-的实现原理"><a href="#Session-的实现原理" class="headerlink" title="Session 的实现原理"></a>Session 的实现原理</h2><ul>
<li>用现象说明问题，我<strong>在 Servlet4 中的代码设置了 Session 的属性</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//得到Session对象</span><br><span class="line">HttpSession httpSession = request.getSession();</span><br><span class="line"></span><br><span class="line">//设置Session属性</span><br><span class="line">httpSession.setAttribute(&quot;name&quot;, &quot;看完博客就要点赞！！&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>接着在 Servlet7 把 Session 的属性取出来</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">String value = (String) request.getSession().getAttribute(&quot;name&quot;);</span><br><span class="line"></span><br><span class="line">printWriter.write(value);</span><br></pre></td></tr></table></figure>
<ul>
<li>自然地，我们<strong>能取到在 Servlet4 中 Session 设置的属性</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-b64e93dfba91e529.png" alt=""></p>
<ul>
<li>接着，我在浏览器中新建一个会话，再次访问 Servlet7</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-84635a0c56461382.png" alt=""></p>
<ul>
<li>发现报了空指针异常的错误</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-e083fb88be053015.png" alt=""></p>
<ul>
<li><p>现在问题来了：<strong>服务器是如何实现一个 session 为一个用户浏览器服务的？换个说法：为什么服务器能够为不同的用户浏览器提供不同 session？</strong></p>
</li>
<li><p>HTTP 协议是无状态的，<strong>Session 不能依据 HTTP 连接来判断是否为同一个用户</strong>。于是乎：<strong>服务器向用户浏览器发送了一个名为 JESSIONID 的 Cookie，它的值是 Session 的 id 值</strong>。其实 Session 依据 Cookie 来识别是否是同一个用户。</p>
</li>
<li><p>简单来说：Session <strong>之所以可以识别不同的用户，依靠的就是 Cookie</strong></p>
</li>
<li><p>该 Cookie 是<strong>服务器自动颁发给浏览器的</strong>，不用我们手工创建的。<strong>该 Cookie 的 maxAge 值默认是 - 1，也就是说仅当前浏览器使用，不将该 Cookie 存在硬盘中</strong></p>
</li>
<li><p>我们来捋一捋思路流程：当我们访问 Servlet4 的时候，<strong>服务器就会创建一个 Session 对象，执行我们的程序代码，并自动颁发个 Cookie 给用户浏览器</strong></p>
</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-aa8becbfe94e2bd6.png" alt=""></p>
<ul>
<li>当我们<strong>用同一个浏览器访问 Servlet7</strong> 的时候，<strong>浏览器会把 Cookie 的值通过 http 协议带过去给服务器，服务器就知道用哪一 Session</strong>。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-59d1709e3cb27f1f.png" alt=""></p>
<ul>
<li>而当我们<strong>使用新会话的浏览器访问 Servlet7 的时候</strong>，<strong>该新浏览器并没有 Cookie，服务器无法辨认使用哪一个 Session，所以就获取不到值</strong></li>
</ul>
<hr>
<h2 id="浏览器禁用了-Cookie，Session-还能用吗？"><a href="#浏览器禁用了-Cookie，Session-还能用吗？" class="headerlink" title="浏览器禁用了 Cookie，Session 还能用吗？"></a>浏览器禁用了 Cookie，Session 还能用吗？</h2><p>上面说了 Session 是依靠 Cookie 来识别用户浏览器的。如果我的用户浏览器禁用了 Cookie 了呢？绝大多数的手机浏览器都不支持 Cookie，那我的 Session 怎么办？</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-4bef34364f1e288e.png" alt=""></p>
<ul>
<li>好的，我们来看看情况是怎么样的。用户浏览器访问 Servlet4 的时候，服务器向用户浏览器颁发了一个 Cookie</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-44093b5442812676.png" alt=""></p>
<ul>
<li>但是呢，当用户浏览器访问 Servlet7 的时候，由于我们<strong>禁用了 Cookie，所以用户浏览器并没有把 Cookie 带过去给服务器</strong>。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-5b8b470a2be37a78.png" alt=""></p>
<ul>
<li><p>一看，Session 好像不能用了。但是 Java Web 提供了解决方法：<strong>URL 地址重写</strong></p>
</li>
<li><p>HttpServletResponse 类提供了两个 URL 地址重写的方法：</p>
<ul>
<li><strong>encodeURL(String url)</strong></li>
<li><strong>encodeRedirectURL(String url)</strong></li>
</ul>
</li>
<li><p>需要值得注意的是：这两个方法会自动判断该浏览器是否支持 Cookie，如果支持 Cookie，重写后的 URL 地址就不会带有 jsessionid 了【当然了，即使浏览器支持 Cookie，第一次输出 URL 地址的时候还是会出现 jsessionid（因为没有任何 Cookie 可带）】</p>
</li>
<li><p>下面我们就以上面 “购物” 的例子来做试验吧！<strong>首先我们来看看禁用掉 Cookie 对原来的小例子有什么影响</strong>。</p>
</li>
<li><p>访问 Servlet1，随便点击一本书籍购买</p>
</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-b130511b7bcfdd35.png" alt=""></p>
<ul>
<li>无论点击多少次，都会直接提示我们有买过任何商品</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-c924b46a62c678f1.png" alt=""></p>
<ul>
<li><p>原因也非常简单，没有 Cookie 传递给服务器，<strong>服务器每次创建的时候都是新的 Session</strong>，导致最后获取到的 List 集合一定是空的。</p>
</li>
<li><p><strong>不同 Servlet 获取到的 Session 的 id 号都是不同的</strong>。</p>
</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-875e25daf8da76fb.png" alt=""></p>
<ul>
<li><p>下面我们就对 URL 进行重写，看看能不能恢复没有禁掉 Cookie 之前的效果。</p>
</li>
<li><p>原则：<strong>把 Session 的属性带过去【传递给】另外一个 Servlet，都要 URL 地址重写</strong></p>
</li>
<li><p>在跳转到显示购买过商品的 Servlet 的时候，URL 地址重写。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">String url = &quot;/ouzicheng/Servlet7&quot;;</span><br><span class="line"></span><br><span class="line">response.sendRedirect(response.encodeURL(url));</span><br></pre></td></tr></table></figure>
<ul>
<li>再次访问 Servlet1，当我点击 javaweb 的时候，已经能够成功出现我买过的商品了。并且 <strong>Session 的 id 通过 URL 地址重写，使用的是同一个 Session</strong></li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-cd3497d111fa5543.png" alt=""> <img src="https://upload-images.jianshu.io/upload_images/5291509-da9fe448c42b03c3.png" alt=""></p>
<ul>
<li>URL 地址重写的原理：<strong>将 Session 的 id 信息重写到 URL 地址中</strong>。<strong>服务器解析重写后 URL，获取 Session 的 id</strong>。这样一来，即使浏览器禁用掉了 Cookie，但 Session 的 id 通过服务器端传递，还是可以使用 Session 来记录用户的状态。</li>
</ul>
<hr>
<h2 id="Session-禁用-Cookie"><a href="#Session-禁用-Cookie" class="headerlink" title="Session 禁用 Cookie"></a>Session 禁用 Cookie</h2><ul>
<li><p>Java Web 规范支持通过配置禁用 Cookie</p>
</li>
<li><p>禁用自己项目的 Cookie</p>
<ul>
<li><strong>在 META-INF 文件夹下的 context.xml 文件中修改（没有则创建）</strong><img src="https://upload-images.jianshu.io/upload_images/5291509-61961cca7253ecd7.png" alt=""></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version=&apos;1.0&apos; encoding=&apos;utf-8&apos;?&gt;</span><br><span class="line"></span><br><span class="line">&lt;Context path=&quot;/ouzicheng&quot; cookies=&quot;false&quot;&gt;</span><br><span class="line">&lt;/Context&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>禁用全部 web 应用的 Cookie</p>
<ul>
<li><strong>在 conf/context.xml 中修改</strong><img src="https://upload-images.jianshu.io/upload_images/5291509-d6bfacad3b35a405.png" alt=""></li>
</ul>
</li>
</ul>
<p>注意：<strong>该配置只是让服务器不能自动维护名为 jsessionid 的 Cookie，并不能阻止 Cookie 的读写。</strong></p>
<hr>
<h2 id="Session-案例"><a href="#Session-案例" class="headerlink" title="Session 案例"></a>Session 案例</h2><h3 id="使用-Session-完成用户简单登陆"><a href="#使用-Session-完成用户简单登陆" class="headerlink" title="使用 Session 完成用户简单登陆"></a>使用 Session 完成用户简单登陆</h3><ul>
<li>先创建 User 类</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private String username = null;</span><br><span class="line">private String password = null;</span><br><span class="line"></span><br><span class="line">public User() &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public User(String username, String password) &#123;</span><br><span class="line">    this.username = username;</span><br><span class="line">    this.password = password;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">....各种set、get方法</span><br></pre></td></tr></table></figure>
<ul>
<li>使用简单的集合模拟一个数据库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private static List&lt;User&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">//装载些数据进数据库</span><br><span class="line">static &#123;</span><br><span class="line"></span><br><span class="line">    list.add(new User(&quot;aaa&quot;,&quot;111&quot;));</span><br><span class="line">    list.add(new User(&quot;bbb&quot;,&quot;222&quot;));</span><br><span class="line">    list.add(new User(&quot;ccc&quot;,&quot;333&quot;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//通过用户名和密码查找用户</span><br><span class="line">public static User find(String username, String password) &#123;</span><br><span class="line"></span><br><span class="line">    for (User user : list) &#123;</span><br><span class="line">        if (user.getUsername().equals(username) &amp;&amp; user.getPassword().equals(password)) &#123;</span><br><span class="line"></span><br><span class="line">            return user;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>表单提交的工作我就在 jsp 写了，如果在 Servlet 写太麻烦了！</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;form action=&quot;/ouzicheng/LoginServlet&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    用户名：&lt;input type=&quot;text&quot; &gt;&lt;br/&gt;</span><br><span class="line">    密码：&lt;input type=&quot;password&quot; &gt;&lt;br/&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>获取到表单提交的数据，查找数据库是否有相对应的用户名和密码</strong>。如果没有就提示用户名或密码出错了，如果有就跳转到另外一个页面</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">String username = request.getParameter(&quot;username&quot;);</span><br><span class="line">String password = request.getParameter(&quot;password&quot;);</span><br><span class="line"></span><br><span class="line">User user = UserDB.find(username, password);</span><br><span class="line"></span><br><span class="line">//如果找不到，就是用户名或密码出错了。</span><br><span class="line">if (user == null) &#123;</span><br><span class="line">    response.getWriter().write(&quot;you can&apos;t login&quot;);</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//标记着该用户已经登陆了！</span><br><span class="line">HttpSession httpSession = request.getSession();</span><br><span class="line">httpSession.setAttribute(&quot;user&quot;, user);</span><br><span class="line"></span><br><span class="line">//跳转到其他页面，告诉用户成功登陆了。</span><br><span class="line">response.sendRedirect(response.encodeURL(&quot;index.jsp&quot;));</span><br></pre></td></tr></table></figure>
<ul>
<li>我们来试试下数据库没有的用户名和密码，提示我不能登陆。</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-a39bcbfadba8b007.png" alt=""> <img src="https://upload-images.jianshu.io/upload_images/5291509-0fea85dd6cad0241.png" alt=""></p>
<ul>
<li>试试数据库存在的用户名和密码</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-8099bd021b449e36.png" alt=""> <img src="https://upload-images.jianshu.io/upload_images/5291509-47bebcd635ae9196.png" alt=""></p>
<hr>
<h3 id="利用-Session-防止表单重复提交"><a href="#利用-Session-防止表单重复提交" class="headerlink" title="利用 Session 防止表单重复提交"></a>利用 Session 防止表单重复提交</h3><ul>
<li><p>重复提交的危害：</p>
<ul>
<li>在投票的网页上不停地提交，实现了刷票的效果。</li>
<li>注册多个用户，不断发帖子，扰乱正常发帖秩序。</li>
</ul>
</li>
<li><p>首先我们来看一下常见的重复提交。</p>
<ul>
<li>在处理表单的 Servlet 中刷新。</li>
<li>后退再提交</li>
<li>网络延迟，多次点击提交按钮</li>
</ul>
</li>
<li><p>下面的 gif 是<strong>后退再提交</strong>，<strong>在处理提交请求的 Servlet 中刷新</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-cc5ba03def509162.gif" alt=""></p>
</li>
<li><p>下面的 gif 是<strong>网络延迟，多次点击提交按钮</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-26986e1309d52a72.gif" alt=""></p>
</li>
<li><p>对于网络延迟造成的多次提交数据给服务器，其实是客户端的问题。于是，我们可以使用 javaScript 来防止这种情况</p>
</li>
<li><p>要做的事情也非常简单：<strong>当用户第一次点击提交按钮时，把数据提交给服务器。当用户再次点击提交按钮时，就不把数据提交给服务器了。</strong></p>
</li>
<li><p><strong>监听用户提交事件</strong>。只能让用户提交一次表单！</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;表单提交&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line"></span><br><span class="line">        //定义一个全局标识量：是否已经提交过表单数据</span><br><span class="line">        var isCommitted = false;</span><br><span class="line"></span><br><span class="line">        function doSubmit() &#123;</span><br><span class="line"></span><br><span class="line">            //false表示的是没有提交过，于是就可以让表单提交给Servlet</span><br><span class="line">            if(isCommitted==false) &#123;</span><br><span class="line"></span><br><span class="line">                isCommitted = true;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action=&quot;/ouzicheng/Servlet7&quot; onsubmit=&quot;return doSubmit()&quot;&gt;</span><br><span class="line"></span><br><span class="line">    用户名：&lt;input type=&quot;text&quot; &gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>好的，我们来试一下是不是真的可以解决网络延迟所造成的多次提交表单数据，注意鼠标，我已经点击过很多次的了！</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-e0d7d6fdd8bd8629.gif" alt=""></p>
<ul>
<li><p>由于网络延迟造成的多次提交数据给服务器，我们还可以使用 javaScript 代码这样解决：<strong>当我点击过一次提交按钮时，我就把提交的按钮隐藏起来。不能让用户点击了</strong>！</p>
</li>
<li><p>想要让按钮隐藏起来，也很简单。<strong>只要获取到按钮的节点，就可以控制按钮的隐藏或显示了！</strong></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    function doSubmit() &#123;</span><br><span class="line">        var button = document.getElementById(&quot;button&quot;);</span><br><span class="line"></span><br><span class="line">        button.disabled = disabled;</span><br><span class="line"></span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>我们再来看一下效果</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-67ec064e68421b07.gif" alt=""></p>
<ul>
<li><p><strong>在处理表单的 Servlet 中刷新</strong>和<strong>后退再提交</strong>这两种方式不能只靠客户端来限制了。也就是说 javaScript 代码无法阻止这两种情况的发生。</p>
</li>
<li><p>于是乎，我们就想得用其他办法来阻止表单数据重复提交了。我们现在学了 Session，<strong>Session 可以用来标识一个用户是否登陆了</strong>。Session 的原理也说了：<strong>不同的用户浏览器会拥有不同的 Session</strong>。而 request 和 ServletContext 为什么就不行呢？<strong>request 的域对象只能是一次 http 请求</strong>，<strong>提交表单数据的时候 request 域对象的数据取不出来</strong>。ServletContext 代表整个 web 应用，<strong>如果有几个用户浏览器同时访问</strong>，<strong>ServletContext 域对象的数据会被多次覆盖掉</strong>，也就是说域对象的数据就毫无意义了。</p>
</li>
<li><p>可能到这里，我们会想到：在提交数据的时候，存进 Session 域对象的数据，在处理提交数据的 Servlet 中判断 Session 域对象数据????。究竟判断 Session 什么？判断 Session 域对象的数据不为 null？<strong>没用呀，既然已经提交过来了，那肯定不为 null。</strong></p>
</li>
<li><p>此时，我们就想到了，在<strong>表单中还有一个隐藏域，可以通过隐藏域把数据交给服务器</strong>。</p>
</li>
<li><p><strong>判断 Session 域对象的数据和 jsp 隐藏域提交的数据是否对应</strong>。</p>
<ul>
<li><strong>判断隐藏域的数据是否为空</strong>【如果为空，<strong>就是直接访问表单处理页面的 Servlet</strong>】</li>
<li><strong>判断 Session 的数据是否为空</strong>【servlet 判断完是否重复提交，<strong>最好能立马移除 Session 的数据</strong>，不然还没有移除的时候，客户端那边儿的请求又来了，就又能匹配了，产生了重复提交。<strong>如果 Session 域对象数据为空，证明已经提交过数据了！</strong>】</li>
</ul>
</li>
<li><p>我们向 Session 域对象的存入数据究竟是什么呢？简单的一个数字？好像也行啊。因为<strong>只要 Session 域对象的数据和 jsp 隐藏域带过去的数据对得上号就行了呀，反正在 Servlet 上判断完是否重复提交，会立马把 Session 的数据移除掉的</strong>。更专业的做法是：<strong>向 Session 域对象存入的数据是一个随机数【Token– 令牌</strong>】。</p>
</li>
<li><p><strong>生成一个独一无二的随机数</strong></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/*</span><br><span class="line">* 产生随机数就应该用一个对象来生成，这样可以避免随机数的重复。</span><br><span class="line">* 所以设计成单例</span><br><span class="line">* */</span><br><span class="line">public class TokenProcessor &#123;</span><br><span class="line"></span><br><span class="line">    private TokenProcessor() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private final static TokenProcessor TOKEN_PROCESSOR = new TokenProcessor();</span><br><span class="line"></span><br><span class="line">    public static TokenProcessor getInstance() &#123;</span><br><span class="line">        return TOKEN_PROCESSOR;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static String makeToken() &#123;</span><br><span class="line"></span><br><span class="line">        //这个随机生成出来的Token的长度是不确定的</span><br><span class="line">        String token = String.valueOf(System.currentTimeMillis() + new Random().nextInt(99999999));</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            //我们想要随机数的长度一致，就要获取到数据指纹</span><br><span class="line">            MessageDigest messageDigest = MessageDigest.getInstance(&quot;md5&quot;);</span><br><span class="line">            byte[] md5 = messageDigest.digest(token.getBytes());</span><br><span class="line"></span><br><span class="line">            //如果我们直接 return  new String(md5)出去，得到的随机数会乱码。</span><br><span class="line">            //因为随机数是任意的01010101010，在转换成字符串的时候，会查gb2312的码表，gb2312码表不一定支持该二进制数据，得到的就是乱码</span><br><span class="line"></span><br><span class="line">            //于是乎经过base64编码成了明文的数据</span><br><span class="line">            BASE64Encoder base64Encoder = new BASE64Encoder();</span><br><span class="line">            return base64Encoder.encode(md5);</span><br><span class="line"></span><br><span class="line">        &#125; catch (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return null;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>创建 Token 随机数，并跳转到 jsp 页面</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//生出随机数</span><br><span class="line">TokenProcessor tokenProcessor = TokenProcessor.getInstance();</span><br><span class="line">String token = tokenProcessor.makeToken();</span><br><span class="line"></span><br><span class="line">//将随机数存进Session中</span><br><span class="line">request.getSession().setAttribute(&quot;token&quot;, token);</span><br><span class="line"></span><br><span class="line">//跳转到显示页面</span><br><span class="line">request.getRequestDispatcher(&quot;/login.jsp&quot;).forward(request, response);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>jsp 隐藏域获取到 Session 的值</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;form action=&quot;/ouzicheng/Servlet7&quot; &gt;</span><br><span class="line"></span><br><span class="line">    用户名：&lt;input type=&quot;text&quot; &gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;提交&quot; id=&quot;button&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;%--使用EL表达式取出session中的Token--%&gt;</span><br><span class="line">    &lt;input type=&quot;hidden&quot; $&#123;token&#125;&quot; &gt;</span><br><span class="line"></span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>在处理表单提交页面中判断：<strong>jsp 隐藏域是否有值带过来，Session 中的值是否为空，Session 中的值和 jsp 隐藏域带过来的值是否相等</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">String serverValue = (String) request.getSession().getAttribute(&quot;token&quot;);</span><br><span class="line">String clientValue = request.getParameter(&quot;token&quot;);</span><br><span class="line"></span><br><span class="line">if (serverValue != null &amp;&amp; clientValue != null &amp;&amp; serverValue.equals(clientValue)) &#123;</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;处理请求&quot;);</span><br><span class="line"></span><br><span class="line">    //清除Session域对象数据</span><br><span class="line">    request.getSession().removeAttribute(&quot;token&quot;);</span><br><span class="line"></span><br><span class="line">&#125;else &#123;</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;请不要重复提交数据！&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>下面我们再来看一下, 已经可以解决表单重复提交的问题了！</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-055564ffdfaacf95.gif" alt=""></p>
<p>实现原理是非常简单的：</p>
<ul>
<li>在 session 域中存储一个 token</li>
<li>然后前台页面的隐藏域获取得到这个 token</li>
<li>在第一次访问的时候，我们就判断 seesion 有没有值，如果有就比对。对比正确后我们就处理请求，接着就把 session 存储的数据给删除了</li>
<li>等到再次访问的时候，我们 session 就没有值了，就不受理前台的请求了！</li>
</ul>
<hr>
<h3 id="一次性校验码"><a href="#一次性校验码" class="headerlink" title="一次性校验码"></a>一次性校验码</h3><ul>
<li><p>一次性校验码其实就是为了<strong>防止暴力猜测密码</strong></p>
</li>
<li><p>在讲 response 对象的时候，我们使用 response 对象输出过验证码，但是没有去验证！</p>
</li>
<li><p>验证的原理也非常简单：<strong>生成验证码后，把验证码的数据存进 Session 域对象中，判断用户输入验证码是否和 Session 域对象的数据一致</strong>。</p>
</li>
<li><p><strong>生成验证码图片，并将验证码存进 Session 域中</strong></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">//在内存中生成图片</span><br><span class="line">BufferedImage bufferedImage = new BufferedImage(80, 20, BufferedImage.TYPE_INT_RGB);</span><br><span class="line"></span><br><span class="line">//获取到这张图片</span><br><span class="line">Graphics2D graphics2D = (Graphics2D) bufferedImage.getGraphics();</span><br><span class="line"></span><br><span class="line">//设置背景色为白色</span><br><span class="line">graphics2D.setColor(Color.white);</span><br><span class="line">graphics2D.fillRect(0, 0, 80, 20);</span><br><span class="line"></span><br><span class="line">//设置图片的字体和颜色</span><br><span class="line">graphics2D.setFont(new Font(null, Font.BOLD, 20));</span><br><span class="line">graphics2D.setColor(Color.BLUE);</span><br><span class="line"></span><br><span class="line">//生成随机数</span><br><span class="line">String randomNum = makeNum();</span><br><span class="line"></span><br><span class="line">//往这张图片上写数据,横坐标是0，纵坐标是20</span><br><span class="line">graphics2D.drawString(randomNum, 0, 20);</span><br><span class="line"></span><br><span class="line">//将随机数存进Session域中</span><br><span class="line">request.getSession().setAttribute(&quot;randomNum&quot;, randomNum);</span><br><span class="line"></span><br><span class="line">//控制浏览器不缓存该图片</span><br><span class="line">response.setHeader(&quot;Expires&quot;, &quot;-1&quot;);</span><br><span class="line">response.setHeader(&quot;Cache-Control&quot;, &quot;no-cache&quot;);</span><br><span class="line">response.setHeader(&quot;Pragma&quot;, &quot;no-cache&quot;);</span><br><span class="line"></span><br><span class="line">//通知浏览器以图片的方式打开</span><br><span class="line">response.setHeader(&quot;Content-type&quot;, &quot;image/jpeg&quot;);</span><br><span class="line"></span><br><span class="line">//把图片写给浏览器</span><br><span class="line">ImageIO.write(bufferedImage, &quot;jpg&quot;, response.getOutputStream());</span><br></pre></td></tr></table></figure>
<ul>
<li>生成随机数的方法：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private String makeNum() &#123;</span><br><span class="line"></span><br><span class="line">    Random random = new Random();</span><br><span class="line"></span><br><span class="line">    //生成0-6位的随机数</span><br><span class="line">    int num = random.nextInt(999999);</span><br><span class="line"></span><br><span class="line">    //验证码的数位全都要6位数，于是将该随机数转换成字符串，不够位数就添加</span><br><span class="line">    String randomNum = String.valueOf(num);</span><br><span class="line"></span><br><span class="line">    //使用StringBuffer来拼凑字符串</span><br><span class="line">    StringBuffer stringBuffer = new StringBuffer();</span><br><span class="line">    for (int i = 0; i &lt; 6 - randomNum.length(); i++) &#123;</span><br><span class="line">        stringBuffer.append(&quot;0&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return stringBuffer.append(randomNum).toString();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>jsp 显示页面</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;form action=&quot;/ouzicheng/Login2Servlet&quot;&gt;</span><br><span class="line"></span><br><span class="line">    用户名：&lt;input type=&quot;text&quot; &gt;&lt;br&gt;</span><br><span class="line">    密码：&lt;input type=&quot;password&quot; &gt;&lt;br&gt;</span><br><span class="line">    验证码：&lt;input type=&quot;text&quot; &gt;</span><br><span class="line">    &lt;img src=&quot;/ouzicheng/ImageServlet&quot; &gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line"></span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>处理提交表单数据的 Servlet，<strong>判断用户带过来验证码的数据是否和 Session 的数据相同。</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//获取用户输入验证码的数据</span><br><span class="line">String client_randomNum = request.getParameter(&quot;randomNum&quot;);</span><br><span class="line"></span><br><span class="line">//获取Session中的数据</span><br><span class="line">String session_randomNum = (String) request.getSession().getAttribute(&quot;randomNum&quot;);</span><br><span class="line"></span><br><span class="line">//判断他俩数据是否相等，用户是否有输入验证码，Session中是否为空</span><br><span class="line">if (client_randomNum == null || session_randomNum == null || !client_randomNum.equals(session_randomNum)) &#123;</span><br><span class="line">    System.out.println(&quot;验证码错误了！！！&quot;);</span><br><span class="line">    return ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//下面就是验证用户名和密码...................</span><br></pre></td></tr></table></figure>
<ul>
<li>显示页面是这样子的</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-ea394f7a0891631f.png" alt=""></p>
<ul>
<li>我们来看一下效果！</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-6346d62b1df5d591.gif" alt=""></p>
<p>对于校验码实现思路是这样子的：</p>
<ul>
<li>使用 awt 语法来描写一张验证码，生成随机数保存在 seesion 域中，我们让验证码不能缓存起来【做到验证码都不一样】</li>
<li>页面直接访问 Servlet 来获取我们的验证码，于是我们验证码的值就会改变【同时 session 的值也会被改变】</li>
<li>当用户验证的时候，就是 session 内的值的验证了。</li>
</ul>
<h2 id="Session-和-Cookie-的区别"><a href="#Session-和-Cookie-的区别" class="headerlink" title="Session 和 Cookie 的区别"></a>Session 和 Cookie 的区别</h2><ul>
<li><strong>从存储方式上比较</strong><ul>
<li>Cookie 只能存储字符串，如果要存储非 ASCII 字符串还要对其编码。</li>
<li>Session 可以存储任何类型的数据，可以把 Session 看成是一个容器</li>
</ul>
</li>
<li><strong>从隐私安全上比较</strong><ul>
<li><strong>Cookie 存储在浏览器中，对客户端是可见的</strong>。信息容易泄露出去。如果使用 Cookie，最好将 Cookie 加密</li>
<li><strong>Session 存储在服务器上，对客户端是透明的</strong>。不存在敏感信息泄露问题。</li>
</ul>
</li>
<li><strong>从有效期上比较</strong><ul>
<li>Cookie 保存在硬盘中，只需要设置 maxAge 属性为比较大的正整数，即使关闭浏览器，Cookie 还是存在的</li>
<li><strong>Session 的保存在服务器中，设置 maxInactiveInterval 属性值来确定 Session 的有效期。并且 Session 依赖于名为 JSESSIONID 的 Cookie，该 Cookie 默认的 maxAge 属性为 - 1。如果关闭了浏览器，该 Session 虽然没有从服务器中消亡，但也就失效了。</strong></li>
</ul>
</li>
<li><strong>从对服务器的负担比较</strong><ul>
<li>Session 是保存在服务器的，每个用户都会产生一个 Session，如果是并发访问的用户非常多，是不能使用 Session 的，Session 会消耗大量的内存。</li>
<li>Cookie 是保存在客户端的。不占用服务器的资源。像 baidu、Sina 这样的大型网站，一般都是使用 Cookie 来进行会话跟踪。</li>
</ul>
</li>
<li><strong>从浏览器的支持上比较</strong><ul>
<li>如果浏览器禁用了 Cookie，那么 Cookie 是无用的了！</li>
<li>如果浏览器禁用了 Cookie，Session 可以通过 URL 地址重写来进行会话跟踪。</li>
</ul>
</li>
<li><strong>从跨域名上比较</strong><ul>
<li>Cookie 可以设置 domain 属性来实现跨域名</li>
<li>Session 只在当前的域名内有效，不可夸域名</li>
</ul>
</li>
</ul>
<hr>
<h2 id="Cookie-和-Session-共同使用"><a href="#Cookie-和-Session-共同使用" class="headerlink" title="Cookie 和 Session 共同使用"></a>Cookie 和 Session 共同使用</h2><ul>
<li><p><strong>如果仅仅使用 Cookie 或仅仅使用 Session 可能达不到理想的效果</strong>。这时应该尝试一下同时使用 Session 和 Cookie</p>
</li>
<li><p>那么，什么时候才需要同时使用 Cookie 和 Session 呢？</p>
</li>
<li><p>在上一篇博客中，我们使用了 Session 来进行简单的购物，功能也的确实现了。现在有一个问题：<strong>我在购物的途中，不小心关闭了浏览器。当我再返回进去浏览器的时候，发现我购买过的商品记录都没了！！为什么会没了呢？原因也非常简单：服务器为 Session 自动维护的 Cookie 的 maxAge 属性默认是 - 1 的，当浏览器关闭掉了，该 Cookie 就自动消亡了。当用户再次访问的时候，已经不是原来的 Cookie 了。</strong></p>
</li>
<li><p>我们现在想的是：<strong>即使我不小心关闭了浏览器了，我重新进去网站，我还能找到我的购买记录</strong>。</p>
</li>
<li><p>要实现该功能也十分简单，问题其实就在：服务器为 Session 自动维护的 Cookie 的 maxAge 属性是 - 1，Cookie 没有保存在硬盘中。我现在要做的就是：<strong>把 Cookie 保存在硬盘中，即使我关闭了浏览器，浏览器再次访问页面的时候，可以带上 Cookie，从而服务器识别出 Session。</strong></p>
</li>
<li><p><strong>第一种方式：</strong>只需要在处理购买页面上创建 Cookie，Cookie 的值是 Session 的 id 返回给浏览器即可</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Cookie cookie = new Cookie(&quot;JSESSIONID&quot;,session.getId());</span><br><span class="line">cookie.setMaxAge(30*60);</span><br><span class="line">cookie.setPath(&quot;/ouzicheng/&quot;);</span><br><span class="line">response.addCookie(cookie);</span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>第二种方式：</strong> <strong>在 server.xml 文件中配置，将每个用户的 Session 在服务器关闭的时候序列化到硬盘或数据库上保存</strong>。但此方法不常用，知道即可！</p>
</li>
<li><p>下面看一下效果</p>
</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/5291509-19a3efecf90f5541.gif" alt=""></p>
<hr>
<blockquote>
<p>参考：<br>Servlet+JSP - 文集 - 简书<br><a href="https://www.jianshu.com/nb/21926044" target="_blank" rel="noopener">https://www.jianshu.com/nb/21926044</a></p>
</blockquote>

      
    </div>
    
    
    


     
    
      <div>
        
    <div style="text-align:center;color: #ccc;font-size:14px;">
        ------ 本文结束<i class="fa fa-paw"></i>感谢您的阅读 ------</div>

      </div>
    


    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    CloudPai
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://cloudpai.site/2018/03/28/2018-03-28-1/" title="Servlet学习">http://cloudpai.site/2018/03/28/2018-03-28-1/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    




    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/servlet/" rel="tag"><i class="fa fa-tag"></i> servlet</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/03/28/2018-03-28/" rel="next" title="Tomcat+Servlet面试总结">
                <i class="fa fa-chevron-left"></i> Tomcat+Servlet面试总结
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/03/28/2018-03-28-2/" rel="prev" title="Java中BIO,NIO,AIO的理解">
                Java中BIO,NIO,AIO的理解 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>




  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="http://p4lmrb1gp.bkt.clouddn.com/君名-squashed.jpg"
                alt="CloudPai" />
            
              <p class="site-author-name" itemprop="name">CloudPai</p>
              <p class="site-description motion-element" itemprop="description">加油(๑•̀ㅂ•́)و✧加油</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">236</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            


<div id="music163player">
    <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=280 height=240 src="//music.163.com/outchain/player?type=0&id=2113726971&auto=0&height=430"></iframe>
</div>
<!-- 459004290 -->




            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">118</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/CloudPai" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:liupai024@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.douban.com/people/57965969/doulists/all" target="_blank" title="豆瓣">
                      
                        <i class="fa fa-fw fa-book"></i>豆瓣</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.zhihu.com/people/cloudPai/activities" target="_blank" title="知乎">
                      
                        <i class="fa fa-fw fa-edit"></i>知乎</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.dlut.edu.cn/" title="DUT" target="_blank">DUT</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.bupt.edu.cn/" title="BUPT" target="_blank">BUPT</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://campus.alibaba.com/index.htm" title="Alibaba Group" target="_blank">Alibaba Group</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Servlet第一篇【介绍Servlet、HTTP协议、WEB目录结构、编写入门Servlet程序、Servlet生命周期】"><span class="nav-text">Servlet第一篇【介绍Servlet、HTTP协议、WEB目录结构、编写入门Servlet程序、Servlet生命周期】</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是-Serlvet？"><span class="nav-text">什么是 Serlvet？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#为什么要用到-Serlvet？"><span class="nav-text">为什么要用到 Serlvet？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTP-协议"><span class="nav-text">HTTP 协议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是-HTPP-协议"><span class="nav-text">什么是 HTPP 协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP1-0-和-HTTP1-1-的区别"><span class="nav-text">HTTP1.0 和 HTTP1.1 的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-请求"><span class="nav-text">HTTP 请求</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#请求行"><span class="nav-text">请求行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#请求头"><span class="nav-text">请求头</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-响应"><span class="nav-text">HTTP 响应</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#状态行"><span class="nav-text">状态行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#响应头"><span class="nav-text">响应头</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Servlet-的作用"><span class="nav-text">Servlet 的作用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JAVAWEB-目录结构"><span class="nav-text">JAVAWEB 目录结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实现-Servlet-接口编写-Servlet-程序"><span class="nav-text">实现 Servlet 接口编写 Servlet 程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#编写-Servlet-程序的步骤"><span class="nav-text">编写 Servlet 程序的步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Serlvet-生命周期"><span class="nav-text">Serlvet 生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Servlet-生命周期可分为-5-个步骤"><span class="nav-text">Servlet 生命周期可分为 5 个步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#继承-HttpServlet-编写-Servlet-程序"><span class="nav-text">继承 HttpServlet 编写 Servlet 程序</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Servlet-第二篇【Servlet-调用图、Servlet-细节、ServletConfig、ServletContext】"><span class="nav-text">Servlet 第二篇【Servlet 调用图、Servlet 细节、ServletConfig、ServletContext】</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Servlet-的调用图"><span class="nav-text">Servlet 的调用图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Servlet-的细节"><span class="nav-text">Servlet 的细节</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一个已经注册的-Servlet-可以被多次映射"><span class="nav-text">一个已经注册的 Servlet 可以被多次映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Servlet-映射的-URL-可以使用通配符"><span class="nav-text">Servlet 映射的 URL 可以使用通配符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Servlet-是单例的"><span class="nav-text">Servlet 是单例的</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#为什么-Servlet-是单例的"><span class="nav-text">为什么 Servlet 是单例的</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#每次访问请求对象和响应对象都是新的"><span class="nav-text">每次访问请求对象和响应对象都是新的</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#线程安全问题"><span class="nav-text">线程安全问题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#load-on-startup"><span class="nav-text">load-on-startup</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在-web-访问任何资源都是在访问-Servlet"><span class="nav-text">在 web 访问任何资源都是在访问 Servlet</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ServletConfig-对象"><span class="nav-text">ServletConfig 对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ServletConfig-对象有什么用？"><span class="nav-text">ServletConfig 对象有什么用？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取-web-xml-文件配置的参数信息"><span class="nav-text">获取 web.xml 文件配置的参数信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ServletContext-对象"><span class="nav-text">ServletContext 对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是-ServletContext-对象？"><span class="nav-text">什么是 ServletContext 对象？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ServletContext-有什么用？"><span class="nav-text">ServletContext 有什么用？</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Servlet-之间实现通讯"><span class="nav-text">Servlet 之间实现通讯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#获取-web-站点配置的信息"><span class="nav-text">获取 web 站点配置的信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#读取资源文件"><span class="nav-text">读取资源文件</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Servlet-第四篇【request-对象常用方法、应用】"><span class="nav-text">Servlet 第四篇【request 对象常用方法、应用】</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是-HttpServletRequest"><span class="nav-text">什么是 HttpServletRequest</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HttpServletRequest-常用方法"><span class="nav-text">HttpServletRequest 常用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#获得客户机【浏览器】信息"><span class="nav-text">获得客户机【浏览器】信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获得客户机请求头"><span class="nav-text">获得客户机请求头</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获得客户机请求参数-客户端提交的数据"><span class="nav-text">获得客户机请求参数 (客户端提交的数据)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HttpServletRequest-应用"><span class="nav-text">HttpServletRequest 应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#防盗链"><span class="nav-text">防盗链</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#表单提交数据【通过-post-方式提交数据】"><span class="nav-text">表单提交数据【通过 post 方式提交数据】</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#超链接方式提交数据"><span class="nav-text">超链接方式提交数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解决中文乱码问题"><span class="nav-text">解决中文乱码问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现转发"><span class="nav-text">实现转发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#转发的时序图"><span class="nav-text">转发的时序图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#请求转发的细节"><span class="nav-text">请求转发的细节</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#转发和重定向的区别"><span class="nav-text">转发和重定向的区别</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#实际发生位置不同，地址栏不同"><span class="nav-text">实际发生位置不同，地址栏不同</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#用法不同"><span class="nav-text">用法不同</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#能够去往的-URL-的范围不一样"><span class="nav-text">能够去往的 URL 的范围不一样</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#传递数据的类型不同"><span class="nav-text">传递数据的类型不同</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#跳转的时间不同"><span class="nav-text">跳转的时间不同</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#转发和重定向使用哪一个？"><span class="nav-text">转发和重定向使用哪一个？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RequestDispatcher-再说明"><span class="nav-text">RequestDispatcher 再说明</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Servlet-第五篇【介绍会话技术、Cookie-的-API、详解、应用】"><span class="nav-text">Servlet 第五篇【介绍会话技术、Cookie 的 API、详解、应用】</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是会话技术"><span class="nav-text">什么是会话技术</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#为什么我们要使用会话技术？"><span class="nav-text">为什么我们要使用会话技术？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cookie"><span class="nav-text">Cookie</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是-Cookie"><span class="nav-text">什么是 Cookie</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cookie-API"><span class="nav-text">Cookie API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#简单使用-Cookie"><span class="nav-text">简单使用 Cookie</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cookie-细节"><span class="nav-text">Cookie 细节</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Cookie-不可跨域名性"><span class="nav-text">Cookie 不可跨域名性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cookie-保存中文"><span class="nav-text">Cookie 保存中文</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cookie-的有效期"><span class="nav-text">Cookie 的有效期</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cookie-的修改和删除"><span class="nav-text">Cookie 的修改和删除</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cookie-的域名"><span class="nav-text">Cookie 的域名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cookie-的路径"><span class="nav-text">Cookie 的路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cookie-的安全属性"><span class="nav-text">Cookie 的安全属性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cookie-的应用"><span class="nav-text">Cookie 的应用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#显示用户上次访问的时间"><span class="nav-text">显示用户上次访问的时间</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#显示上次浏览过商品"><span class="nav-text">显示上次浏览过商品</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Servlet-第六篇【Session-介绍、API、生命周期、应用、与-Cookie-区别】"><span class="nav-text">Servlet 第六篇【Session 介绍、API、生命周期、应用、与 Cookie 区别】</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是-Session"><span class="nav-text">什么是 Session</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#为什么要使用-Session-技术？"><span class="nav-text">为什么要使用 Session 技术？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Session-API"><span class="nav-text">Session API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Session-作为域对象"><span class="nav-text">Session 作为域对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Session-的生命周期和有效期"><span class="nav-text">Session 的生命周期和有效期</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-Session-完成简单的购物功能"><span class="nav-text">使用 Session 完成简单的购物功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Session-的实现原理"><span class="nav-text">Session 的实现原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#浏览器禁用了-Cookie，Session-还能用吗？"><span class="nav-text">浏览器禁用了 Cookie，Session 还能用吗？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Session-禁用-Cookie"><span class="nav-text">Session 禁用 Cookie</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Session-案例"><span class="nav-text">Session 案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-Session-完成用户简单登陆"><span class="nav-text">使用 Session 完成用户简单登陆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#利用-Session-防止表单重复提交"><span class="nav-text">利用 Session 防止表单重复提交</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一次性校验码"><span class="nav-text">一次性校验码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Session-和-Cookie-的区别"><span class="nav-text">Session 和 Cookie 的区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cookie-和-Session-共同使用"><span class="nav-text">Cookie 和 Session 共同使用</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CloudPai</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">915.3k</span>
  
</div>




<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv">  </span>
</span>
</div>







  <div class="theme-info">&#12288;主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://cloudpai.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://cloudpai.site/2018/03/28/2018-03-28-1/';
          this.page.identifier = '2018/03/28/2018-03-28-1/';
          this.page.title = 'Servlet学习';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://cloudpai.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

  <!-- <!-- <script src="https://cdn.bootcss.com/aplayer/1.6.0/APlayer.min.js"></script>

<script src="https://api.i-meto.com/music/player.js"></script> --> -->
  
  <!--移动端判断，是否引入背景-->
  <script>
  var browser={  
      versions:function(){   
             var u = navigator.userAgent, app = navigator.appVersion;   
             return {//移动终端浏览器版本信息
                  trident: u.indexOf('Trident') > -1, //IE内核
                  presto: u.indexOf('Presto') > -1, //opera内核
                  webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
                  gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
                  mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
                  ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
                  android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
                  iPhone: u.indexOf('iPhone') > -1 , //是否为iPhone或者QQHD浏览器
                  iPad: u.indexOf('iPad') > -1, //是否iPad
                  webApp: u.indexOf('Safari') == -1 //是否web应该程序，没有头部与底部
              };  
           }(),  
           language:(navigator.browserLanguage || navigator.language).toLowerCase()  
  }   
    if(browser.versions.mobile || browser.versions.ios || browser.versions.android ||   
      browser.versions.iPhone || browser.versions.iPad){        
               
    }else{
    document.write("<script type=\'text/javascript\'  src=\'/js/src/particle.js\'><\/script>");
    }
  </script>

  
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":-80,"vOffset":-50},"mobile":{"show":false,"scale":0.2},"react":{"opacityDefault":1,"opacityOnHover":0.2}});</script></body>
</html>
